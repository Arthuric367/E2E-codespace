<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2E Outage Platform - Administration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: white;
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .app-container {
            flex: 1;
            overflow: auto;
            height: calc(100vh - 70px);
        }

        /* Header */
        .header {
            background-color: white;
            color: #2c5aa0;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-icon {
            background: none;
            border: none;
            color:black;
            font-size: 16px;
            cursor: pointer;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 26px;
            font-weight: bold;
        }

        .logo-icon {
            width: 35px;
            height: 35px;
            background-color: #2c5aa0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }

        .platform-title {
            font-size: 26px;
            font-weight: bold;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            background-color: #4a6fa5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid #e0e0e0;
            padding: 20px 0;
            overflow-y: auto;
            position: fixed;
            top: 70px;
            left: -280px;
            height: calc(100vh - 70px);
            transition: left 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        .sidebar.show {
            left: 0;
        }

        /* Sidebar overlay for mobile/tablet */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin: 0;
        }

        .nav-link {
            display: block;
            padding: 15px 25px;
            color: #666;
            text-decoration: none;
            font-size: 16px;
            font-weight: 400;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: #f8f9fa;
            color: #333;
        }

        .nav-link.active {
            background-color: #b3c6e0;
            color: #2c5aa0;
            border-left-color: #2c5aa0;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            width: 100%;
            padding: 30px;
            min-height: 100%;
            box-sizing: border-box;
        }

        .page-title {
            font-size: 28px;
            color: #666;
            margin-bottom: 30px;
            font-weight: 400;
        }

        /* Tab Navigation */
        .tab-navigation {
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }

        .tab-list {
            display: flex;
            gap: 40px;
        }

        .tab {
            padding: 12px 0;
            font-size: 16px;
            color: #666;
            text-decoration: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #2c5aa0;
            border-bottom-color: #2c5aa0;
            font-weight: 500;
        }

        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #2c5aa0;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1e3d6f;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn-secondary:active {
            transform: scale(0.98);
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .filter-group:first-child {
            min-width: 220px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            min-width: 120px;
        }

        .search-box {
            padding: 8px 35px 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 250px;
        }

        .search-icon {
            color: #666;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            font-size: 14px;
        }

        /* Table */
        .user-table {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 500;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        th.sortable {
            cursor: pointer;
            position: relative;
            user-select: none;
        }

        th.sortable:after {
            content: "↕";
            position: absolute;
            right: 8px;
            color: #999;
            font-weight: normal;
        }

        th.sortable.asc:after {
            content: "↑";
            color: #2c5aa0;
            font-weight: bold;
        }

        th.sortable.desc:after {
            content: "↓";
            color: #2c5aa0;
            font-weight: bold;
        }

        th.sortable:hover {
            background-color: #e9ecef;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .hidden {
            display: none !important;
        }

        /* Status badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .status-active {
            background-color: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Action buttons in table */
        .table-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .action-btn:hover {
            background-color: #f0f0f0;
        }

        .edit-btn {
            color: #666;
        }

        .delete-btn {
            color: #dc3545;
        }

        /* Toggle switch */
        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background-color: #ccc;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: #2c5aa0;
        }

        .toggle-switch:before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .toggle-switch.active:before {
            transform: translateX(20px);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 20px;
        }

        .pagination button {
            background: none;
            border: 1px solid #ddd;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .pagination button:hover {
            background-color: #f0f0f0;
        }

        .pagination button.active {
            background-color: #2c5aa0;
            color: white;
            border-color: #2c5aa0;
        }

        /* Edit mode styles */
        .edit-mode {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
        }

        .role-select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            min-width: 120px;
        }

        .save-cancel-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-save {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-save:hover {
            background-color: #1e3d6f;
        }

        .btn-cancel {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-cancel:hover {
            background-color: #545b62;
        }

        /* Update message popup */
        .update-message {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            transform: translateX(400px);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
        }

        /* Update message with high z-index for overlay situations */
        .update-message.overlay-mode {
            z-index: 15000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border-width: 2px;
        }

        .update-message.show {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }

        .update-message .close-btn {
            background: none;
            border: none;
            color: #155724;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            padding: 0;
        }

        /* Warning Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: 8px;
            padding: 24px;
            min-width: 400px;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .modal-close {
            background: white;
            border: 1px solid #ddd;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #666;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background-color: #f5f5f5;
            border-color: #999;
        }

        .modal-icon {
            width: 24px;
            height: 24px;
            background-color: #dc3545;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .modal-body {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn-modal {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-modal-primary {
            background-color: #2c5aa0;
            color: white;
        }

        .btn-modal-primary:hover {
            background-color: #1e3d6f;
        }

        .btn-modal-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-modal-danger:hover {
            background-color: #c82333;
        }

        .btn-modal-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-modal-secondary:hover {
            background-color: #545b62;
        }

        /* Success message for deletion */
        .update-message.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .update-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        /* Customer Management Styles */
        .customer-section {
            display: none;
        }

        .customer-section.active {
            display: block;
        }

        .customer-form {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 20px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-title {
            font-size: 18px;
            font-weight: 500;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-option label {
            font-size: 14px;
            color: #333;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }

        .form-input {
            width: 300px;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .form-select-multiple {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            color: #333;
            background-color: #fff;
            min-height: 80px;
            resize: vertical;
        }

        .form-select-multiple:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .form-help {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        .required-asterisk {
            color: #dc3545;
            font-weight: bold;
        }



        /* Custom Multiple Selection Dropdown */
        .multi-select-dropdown {
            position: relative;
            width: 100%;
            min-width: 200px;
        }

        .multi-select-button {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #333;
        }

        .multi-select-button:hover {
            border-color: #2c5aa0;
        }

        .multi-select-button.open {
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .multi-select-dropdown-arrow {
            transition: transform 0.3s ease;
        }

        .multi-select-dropdown-arrow.open {
            transform: rotate(180deg);
        }

        .multi-select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            min-width: 220px;
        }

        .multi-select-options.show {
            display: block;
        }

        .multi-select-option {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .multi-select-option:hover {
            background-color: #f8f9fa;
        }

        .multi-select-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #2c5aa0;
        }

        .multi-select-option label {
            font-size: 14px;
            color: #333;
            cursor: pointer;
            margin: 0;
            flex: 1;
            white-space: nowrap;
        }

        .multi-select-selected-count {
            background-color: #2c5aa0;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            margin-left: 8px;
        }

        /* Import Summary Modal Styles */
        .import-summary-content {
            text-align: left;
        }

        .import-summary-message {
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .import-summary-stats {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .import-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .import-stat-label {
            font-weight: 600;
            font-size: 14px;
        }

        .import-stat-value {
            font-size: 18px;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .import-stat.success .import-stat-label {
            color: #28a745;
        }

        .import-stat.success .import-stat-value {
            color: #28a745;
        }

        .import-stat.failed .import-stat-label {
            color: #dc3545;
        }

        .import-stat.failed .import-stat-value {
            color: #dc3545;
        }

        .import-errors {
            margin-top: 15px;
        }

        .import-errors-list {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .import-error-item {
            color: #856404;
            font-size: 14px;
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .import-error-item:last-child {
            margin-bottom: 0;
        }

        .customer-account-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: nowrap;
            max-width: 100%;
        }

        .customer-account-input {
            width: 150px;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
            flex-shrink: 1;
            min-width: 120px;
        }

        .customer-account-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 20px;
        }

        .btn-load {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-load:hover {
            background-color: #1e3d6f;
        }

        .btn-opt-out {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-opt-out:hover {
            background-color: #1e3d6f;
        }

        /* Responsive layout for customer account section */
        @media (max-width: 7px) {
            .customer-account-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .customer-account-input {
                width: 100%;
                max-width: 300px;
            }
            
            .btn-load, .btn-opt-out {
                width: 100%;
                max-width: 200px;
            }
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .btn-form-cancel {
            background-color: white;
            color: #6c757d;
            border: 1px solid #6c757d;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-form-cancel:hover {
            background-color: #6c757d;
            color: white;
        }

        .btn-form-save {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-form-save:hover {
            background-color: #1e3d6f;
        }

        /* Content sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Channel Preferences Section */
        .preferences-section {
            margin-top: 30px;
            display: none;
        }

        .preferences-section.active {
            display: block;
        }

        .preferences-box {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 25px;
            margin-top: 20px;
        }

        .channel-toggle-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .channel-toggle-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .main-toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background-color: #ddd;
            border-radius: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .main-toggle-switch.active {
            background-color: #2c5aa0;
        }

        .main-toggle-switch:before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .main-toggle-switch.active:before {
            transform: translateX(26px);
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 20px;
        }

        .channel-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .channel-title {
            font-size: 14px;
            font-weight: 500;
            color: #666;
            margin-bottom: 5px;
        }

        .channel-options {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .channel-toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background-color: #ddd;
            border-radius: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .channel-toggle.active {
            background-color: #2c5aa0;
        }

        .channel-toggle:before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .channel-toggle.active:before {
            transform: translateX(26px);
        }

        .toggle-labels {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: #666;
        }

        .label-opt-out {
            min-width: 50px;
        }

        .label-opt-in {
            min-width: 40px;
        }

        /* Opt-Out Exception Report Overlay */
        .report-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .report-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .report-modal {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 1000px;
            height: 80%;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .report-overlay.show .report-modal {
            transform: scale(1);
        }

        .report-header {
            background-color: #6b8bc7;
            color: white;
            padding: 20px 30px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-title {
            font-size: 20px;
            font-weight: 500;
            margin: 0;
        }

        .report-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .report-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .report-content {
            padding: 25px 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .report-filters {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .date-filter {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            min-width: 140px;
            cursor: pointer;
        }

        .date-filter:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .customer-search {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 280px;
            background-color: white;
        }

        .customer-search:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .customer-search::placeholder {
            color: #999;
        }

        .report-table-container {
            flex: 1;
            overflow: auto;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }

        .report-table th {
            background-color: #f8f9fa;
            padding: 15px 20px;
            text-align: left;
            font-weight: 500;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .report-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #333;
        }

        .report-table tr:hover {
            background-color: #f8f9fa;
        }

        .report-table tr:last-child td {
            border-bottom: none;
        }

        .customer-account {
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        .reply-time {
            color: #666;
        }

        .reply-message {
            font-weight: 500;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }

        /* Bulk Upload Section */
        .bulk-upload-section {
            display: none;
            margin-top: 25px;
        }

        .bulk-upload-section.active {
            display: block;
        }

        .file-upload-container {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            position: relative;
            flex: 1;
        }

        .file-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px dashed #ddd;
            border-radius: 6px;
            background-color: #fafafa;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input:hover {
            border-color: #2c5aa0;
            background-color: #f0f4ff;
        }

        .file-input.has-file {
            border-style: solid;
            border-color: #28a745;
            background-color: #f8fff9;
            color: #28a745;
        }

        .hidden-file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .upload-btn {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            min-width: 100px;
        }

        .upload-btn:hover {
            background-color: #1e3d6f;
        }

        .upload-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .upload-instructions {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .instructions-title {
            font-size: 16px;
            font-weight: 500;
            color: #2c5aa0;
            margin-bottom: 10px;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .instructions-list li {
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .instructions-list li:before {
            content: "•";
            color: #2c5aa0;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .sample-download {
            margin-top: 15px;
        }

        .download-link {
            color: #2c5aa0;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
        }

        .download-link:hover {
            text-decoration: underline;
        }

        .upload-progress {
            display: none;
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #2c5aa0;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
            text-align: center;
        }

        /* Bulk Upload Modal */
        .bulk-upload-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .bulk-upload-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .bulk-upload-modal {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .bulk-upload-overlay.show .bulk-upload-modal {
            transform: scale(1);
        }

        .bulk-modal-header {
            padding: 25px 30px 20px;
            border-bottom: 1px solid #e0e0e0;
            position: relative;
        }

        .bulk-modal-title {
            font-size: 18px;
            font-weight: 500;
            color: #333;
            margin: 0;
            padding-right: 40px;
        }

        .bulk-modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .bulk-modal-close:hover {
            background-color: #f0f0f0;
            color: #333;
        }

        .bulk-modal-content {
            padding: 25px 30px 30px;
        }

        .bulk-modal-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 30px;
        }

        .bulk-modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-download-template {
            background-color: white;
            color: #2c5aa0;
            border: 2px solid #2c5aa0;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .btn-download-template:hover {
            background-color: #f0f4ff;
        }

        .btn-upload-file {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-upload-file:hover {
            background-color: #1e3d6f;
        }

        .hidden-bulk-file-input {
            display: none;
        }

        /* Role Management Styles */
        .roles-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
            padding-bottom: 40px;
        }

        .role-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .role-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .role-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .role-info h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #2c5aa0;
        }

        .role-users {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #666;
        }

        .role-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            background: none;
            border: 1px solid #ddd;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background-color: #f5f5f5;
            border-color: #999;
        }

        .btn-icon.btn-danger {
            color: #dc3545;
            border-color: #dc3545;
        }

        .btn-icon.btn-danger:hover {
            background-color: #dc3545;
            color: white;
        }

        .role-permissions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            flex: 1;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            border-radius: 4px;
            font-size: 14px;
        }

        .permission-item.granted {
            color: #198754;
            background-color: #f8fff9;
        }

        .permission-item.denied {
            color: #dc3545;
            background-color: #fff5f5;
        }

        .permission-icon {
            font-weight: bold;
            font-size: 12px;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .permission-item.granted .permission-icon {
            background-color: #198754;
            color: white;
        }

        .permission-item.denied .permission-icon {
            background-color: #dc3545;
            color: white;
        }

        /* Role Management Modal Styles */
        .role-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .role-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .role-modal {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .role-modal-overlay.show .role-modal {
            transform: scale(1);
        }

        .role-modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .role-modal-title {
            margin: 0;
            font-size: 20px;
            color: #2c5aa0;
            font-weight: 600;
        }

        .role-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .role-modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 15px;
        }

        .permission-item-modal {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #dc3545;
        }

        .permission-item-modal:hover {
            background-color: #f8f9fa;
            border-color: #ccc;
        }

        .permission-item-modal.selected {
            color: #198754;
            background-color: #f8fff9;
            border-color: #198754;
        }

        .permission-icon-modal {
            font-weight: bold;
            font-size: 14px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .permission-item-modal .permission-icon-modal {
            background-color: #dc3545;
            color: white;
        }

        .permission-item-modal.selected .permission-icon-modal {
            background-color: #198754;
            color: white;
        }

        .role-modal-footer {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        @media (max-width: 1200px) {
            .roles-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .roles-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Settings Section Styles */
        .settings-group {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .settings-group-header {
            padding: 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.2s ease;
        }

        .settings-group-header:hover {
            background-color: #e9ecef;
        }

        .settings-group-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .settings-group-icon {
            font-size: 14px;
            color: #666;
            transition: transform 0.2s ease;
        }

        .settings-group-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .settings-group-content.expanded {
            padding: 20px;
            max-height: none;
        }

        .settings-group-header .settings-group-icon.expanded {
            transform: rotate(90deg);
        }

        .settings-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .setting-item {
            flex: 1;
            min-width: 200px;
        }

        .setting-group-vertical {
            flex: 1;
        }

        .setting-label {
            display: block;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .setting-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .setting-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        /* Remove arrows from number inputs */
        .setting-input.integer-only::-webkit-inner-spin-button,
        .setting-input.integer-only::-webkit-outer-spin-button,
        .inline-input.integer-only::-webkit-inner-spin-button,
        .inline-input.integer-only::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .setting-input.integer-only,
        .inline-input.integer-only {
            -moz-appearance: textfield;
        }

        .inline-input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            margin: 0 4px;
            transition: all 0.2s ease;
        }

        .inline-input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }

        .alert-description {
            padding: 16px 0;
        }

        .alert-description p {
            font-size: 14px;
            color: #333;
            line-height: 1.6;
            margin: 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .delay-settings {
            padding: 16px 0;
        }

        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 28px;
            background-color: #ccc;
            border-radius: 28px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            padding: 2px;
        }

        .toggle-switch.active {
            background-color: #2c5aa0;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: white;
            transition: transform 0.3s ease;
            transform: translateX(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::before {
            transform: translateX(32px);
        }

        /* User Management table toggle switches - smaller size */
        .user-table .toggle-switch {
            width: 40px;
            height: 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-table .toggle-switch:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .user-table .toggle-switch::before {
            width: 16px;
            height: 16px;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .user-table .toggle-switch.active::before {
            transform: translateX(20px);
        }

        .toggle-label {
            position: absolute;
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 0.5px;
            z-index: 1;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .toggle-switch.active .toggle-label {
            left: 8px;
            color: white;
        }

        .toggle-switch:not(.active) .toggle-label {
            right: 8px;
            color: #666;
        }

        .toggle-text {
            font-size: 14px;
            color: #333;
        }

        .settings-actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 12px;
        }

        .settings-placeholder {
            padding: 40px;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Trigger Mode Styles */
        .trigger-settings {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .trigger-item {
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .trigger-item:last-child {
            border-bottom: none;
        }

        .trigger-info {
            width: 100%;
        }

        .trigger-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .trigger-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .trigger-description {
            font-size: 13px;
            color: #666;
            margin: 0;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .trigger-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .trigger-item .toggle-switch {
                align-self: flex-end;
            }
        }

        @media (max-width: 768px) {
            .settings-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .setting-item {
                min-width: auto;
            }
            
            .settings-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="menu-icon">☰</button>
            <div class="logo">
                <span>CLP</span>
                <div class="logo-icon">中</div>
                <span>中電</span>
            </div>
        </div>
        <div class="platform-title">E2E Outage Communication Platform</div>
        <div class="user-avatar">JD</div>
    </header>

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active">Administration</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Template Management</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Notifications Management</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Outage History</a>
                </li>
            </ul>
        </nav>
    </aside>

    <div class="app-container">
        <!-- Main Content -->
        <main class="main-content">
        <h1 class="page-title">Administration</h1>

        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <div class="tab-list">
                <a href="#" id="nav-users" class="tab active">Users</a>
                <a href="#" id="nav-customer" class="tab">Customer</a>
                <a href="#" id="nav-roles" class="tab">Roles</a>
                <a href="#" id="nav-settings" class="tab">Settings</a>
            </div>
        </nav>

        <!-- User Management Section -->
        <section id="usersSection" class="content-section active">
            <div class="section-header">
                <h2 class="section-title">User Management</h2>
                <div class="action-buttons">
                    <button id="addUserBtn" class="btn btn-primary" onclick="showAddUserModal()">+ Add New User</button>
                    <button id="bulkUploadBtn" class="btn btn-secondary" onclick="showBulkUploadUserModal()">+ Add New User by Bulk Upload</button>
                    <button id="deleteSelectedBtn" class="btn btn-danger" onclick="deleteSelectedUsers()">Delete Selected</button>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <div class="multi-select-dropdown" id="roleFilter">
                        <button class="multi-select-button" onclick="toggleMultiSelect('roleFilter')">
                            <span id="roleFilterText">All Roles</span>
                            <span class="multi-select-dropdown-arrow">▼</span>
                        </button>
                        <div class="multi-select-options">
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_system_admin" value="system admin" onchange="updateRoleFilter()">
                                <label for="role_filter_system_admin">System Admin</label>
                            </div>
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_cic_team" value="cic team" onchange="updateRoleFilter()">
                                <label for="role_filter_cic_team">CIC Team</label>
                            </div>
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_account_manager" value="account manager" onchange="updateRoleFilter()">
                                <label for="role_filter_account_manager">Account Manager</label>
                            </div>
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_corporate_affairs" value="corporate affairs" onchange="updateRoleFilter()">
                                <label for="role_filter_corporate_affairs">Corporate Affairs</label>
                            </div>
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_management" value="management" onchange="updateRoleFilter()">
                                <label for="role_filter_management">Management</label>
                            </div>
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_psbg_engineers" value="psbg engineers" onchange="updateRoleFilter()">
                                <label for="role_filter_psbg_engineers">PSBG Engineers</label>
                            </div>
                            <div class="multi-select-option">
                                <input type="checkbox" id="role_filter_user" value="user" onchange="updateRoleFilter()">
                                <label for="role_filter_user">User</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="filter-group">
                    <select class="filter-select" id="statusFilter" onchange="filterUsers()">
                        <option value="">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="filter-group">
                    <input type="text" class="search-box" id="userSearch" placeholder="Search by name or email" oninput="filterUsers()">
                    <span class="search-icon">🔍</span>
                </div>
                <div class="filter-group">
                    <button id="clearFiltersBtn" class="btn btn-secondary" onclick="clearAllFilters()" title="Reset all filters">
                        🔄 Clear Filters
                    </button>
                </div>
            </div>

            <!-- User Table -->
            <div class="user-table">
                <table id="userTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllUsers" onclick="toggleSelectAll(this)"></th>
                            <th class="sortable" data-column="name" onclick="sortTable('name')">Name</th>
                            <th class="sortable" data-column="email" onclick="sortTable('email')">Email</th>
                            <th class="sortable" data-column="role" onclick="sortTable('role')">Role</th>
                            <th class="sortable" data-column="status" onclick="sortTable('status')">Status</th>
                            <th class="sortable" data-column="lastlogin" onclick="sortTable('lastlogin')">Last Login</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-status="active" data-role="system admin" data-name="john smith" data-email="john.smith@clp.com.hk" data-lastlogin="2025-08-11 13:41:30">
                            <td><input type="checkbox" class="user-checkbox"></td>
                            <td>John Smith</td>
                            <td>john.smith@clp.com.hk</td>
                            <td class="role-cell">System Admin</td>
                            <td><span class="status-badge status-active">Active</span></td>
                            <td>2025-08-11 13:41:30</td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                                    <div class="toggle-switch active"></div>
                                </div>
                            </td>
                        </tr>
                        <tr data-status="inactive" data-role="Account Manager" data-name="James smith" data-email="james.smith@clp.com.hk" data-lastlogin="2025-08-11 13:41:30">
                            <td><input type="checkbox" class="user-checkbox"></td>
                            <td>James Smith</td>
                            <td>james.smith@clp.com.hk</td>
                            <td class="role-cell">Account Manager</td>
                            <td><span class="status-badge status-inactive">Inactive</span></td>
                            <td>2025-08-11 13:41:30</td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                                    <div class="toggle-switch"></div>
                                </div>
                            </td>
                        </tr>
                        <tr data-status="active" data-role="system admin" data-name="john smith" data-email="john.smith@clp.com.hk" data-lastlogin="2025-08-11 13:41:30">
                            <td><input type="checkbox" class="user-checkbox"></td>
                            <td>John Smith</td>
                            <td>john.smith@clp.com.hk</td>
                            <td class="role-cell">System Admin</td>
                            <td><span class="status-badge status-active">Active</span></td>
                            <td>2025-08-11 13:41:30</td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                                    <div class="toggle-switch active"></div>
                                </div>
                            </td>
                        </tr>
                        <tr data-status="active" data-role="system admin" data-name="jane doe" data-email="jane.doe@clp.com.hk" data-lastlogin="2025-08-10 09:15:22">
                            <td><input type="checkbox" class="user-checkbox"></td>
                            <td>Jane Doe</td>
                            <td>jane.doe@clp.com.hk</td>
                            <td class="role-cell">System Admin</td>
                            <td><span class="status-badge status-active">Active</span></td>
                            <td>2025-08-10 09:15:22</td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                                    <div class="toggle-switch active"></div>
                                </div>
                            </td>
                        </tr>
                        <tr data-status="active" data-role="user" data-name="mike johnson" data-email="mike.johnson@clp.com.hk" data-lastlogin="2025-08-12 16:30:45">
                            <td><input type="checkbox" class="user-checkbox"></td>
                            <td>Mike Johnson</td>
                            <td>mike.johnson@clp.com.hk</td>
                            <td class="role-cell">User</td>
                            <td><span class="status-badge status-active">Active</span></td>
                            <td>2025-08-12 16:30:45</td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                                    <div class="toggle-switch active"></div>
                                </div>
                            </td>
                        </tr>
                        <tr data-status="inactive" data-role="user" data-name="sarah wilson" data-email="sarah.wilson@clp.com.hk" data-lastlogin="2025-08-09 14:22:10">
                            <td><input type="checkbox" class="user-checkbox"></td>
                            <td>Sarah Wilson</td>
                            <td>sarah.wilson@clp.com.hk</td>
                            <td class="role-cell">User</td>
                            <td><span class="status-badge status-inactive">Inactive</span></td>
                            <td>2025-08-09 14:22:10</td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                                    <div class="toggle-switch"></div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button>‹</button>
                <button class="active">1</button>
                <button>2</button>
                <button>3</button>
                <button>...</button>
                <button>8</button>
                <button>›</button>
            </div>
        </section>

        <!-- Customer Management Section -->
        <section id="customerSection" class="content-section customer-section">
            <div class="section-header">
                <h2 class="section-title">Customer Management</h2>
            </div>

            <div class="customer-form">
                <div class="form-section">
                    <h3 class="form-title">Customer Management</h3>
                    
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="manualInput" name="inputMethod" value="manual" checked onchange="toggleInputMethod()">
                            <label for="manualInput">Manual Input</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="bulkUpload" name="inputMethod" value="bulk" onchange="toggleInputMethod()">
                            <label for="bulkUpload">Bulk Upload</label>
                        </div>
                    </div>

                    <!-- Manual Input Section -->
                    <div id="manualInputSection" class="input-method-section">
                        <div class="form-group">
                            <label for="customerAccount" class="form-label">Customer Account (CA)</label>
                            <div class="customer-account-row">
                                <input type="text" id="customerAccount" class="customer-account-input" value="" placeholder="Enter Customer Account">
                                <button class="btn-load" onclick="loadCustomerPreference()">Load Preference</button>
                                <button class="btn-opt-out" onclick="generateOptOutReport()">Opt-Out Exception Report</button>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Upload Section -->
                    <div id="bulkUploadSection" class="bulk-upload-section">
                        <div class="upload-instructions">
                            <div class="instructions-title">Upload Instructions</div>
                            <ul class="instructions-list">
                                <li>File must be in CSV format (.csv)</li>
                                <li>Maximum file size: 10MB</li>
                                <li>Required columns: Customer Account, App Push, SMS, Email</li>
                                <li>Channel values should be "opt-in" or "opt-out"</li>
                                <li>First row should contain column headers</li>
                            </ul>
                            <div class="sample-download">
                                <a href="#" class="download-link" onclick="downloadSampleCSV()">📥 Download Sample CSV Template</a>
                            </div>
                        </div>

                        <div class="file-upload-container">
                            <div class="file-input-wrapper">
                                <input type="file" id="csvFileInput" class="hidden-file-input" accept=".csv" onchange="handleFileSelect(this)">
                                <div class="file-input" onclick="document.getElementById('csvFileInput').click()">
                                    <span id="fileInputText">Click for selecting the .csv file to upload</span>
                                </div>
                            </div>
                            <button class="upload-btn" id="uploadBtn" onclick="showBulkUploadModal()">Upload</button>
                        </div>

                        <div id="uploadProgress" class="upload-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-text" id="progressText">Uploading...</div>
                        </div>
                    </div>
                </div>

                <!-- Channel Preferences Section -->
                <div id="preferencesSection" class="preferences-section">
                    <div class="preferences-box">
                        <div class="channel-toggle-header">
                            <span class="channel-toggle-title">Channel Opt-out/Opt-in</span>
                            <div class="main-toggle-switch active" id="mainToggle" onclick="toggleMainPreference()"></div>
                        </div>
                        
                        <div class="channels-grid">
                            <div class="channel-group">
                                <div class="channel-title">App Push:</div>
                                <div class="channel-options">
                                    <div class="toggle-labels">
                                        <span class="label-opt-out">Opt-out</span>
                                        <div class="channel-toggle active" data-channel="app-push" onclick="toggleChannel(this)"></div>
                                        <span class="label-opt-in">Opt-in</span>
                                    </div>
                                </div>
                            </div>

                            <div class="channel-group">
                                <div class="channel-title">SMS:</div>
                                <div class="channel-options">
                                    <div class="toggle-labels">
                                        <span class="label-opt-out">Opt-out</span>
                                        <div class="channel-toggle active" data-channel="sms" onclick="toggleChannel(this)"></div>
                                        <span class="label-opt-in">Opt-in</span>
                                    </div>
                                </div>
                            </div>

                            <div class="channel-group">
                                <div class="channel-title">Email:</div>
                                <div class="channel-options">
                                    <div class="toggle-labels">
                                        <span class="label-opt-out">Opt-out</span>
                                        <div class="channel-toggle" data-channel="email" onclick="toggleChannel(this)"></div>
                                        <span class="label-opt-in">Opt-in</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn-form-cancel" onclick="cancelCustomerForm()">Cancel</button>
                    <button class="btn-form-save" onclick="saveCustomerForm()">Save</button>
                </div>
            </div>
        </section>

        <!-- Role Management Section -->
        <section id="rolesSection" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Role Management</h2>
                <div class="action-buttons">
                    <button id="addRoleBtn" class="btn btn-primary" onclick="showCreateRoleModal()">Create New Role</button>
                </div>
            </div>

            <!-- Roles Grid -->
            <div id="roleTable" class="roles-grid">
                <!-- System Admin Role -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-info">
                            <h3 class="role-name">System Admin</h3>
                            <p class="role-users">5 Users</p>
                        </div>
                        <div class="role-actions">
                            <button class="btn-icon edit-role-btn" onclick="editRole('system-admin')" title="Edit Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 9.207l-3-3L12.146.146zM11.207 10.5l-3-3L2.854 13.854a.5.5 0 0 0-.146.353V16h1.793a.5.5 0 0 0 .353-.146L11.207 10.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger delete-role-btn" onclick="deleteRole('system-admin')" title="Delete Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="role-permissions">
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Full Dashboard Access</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Outage Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Emergency Stop</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>User Administration</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Template Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Send Notifications</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Access Residential Customer Information</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Access Non-Residential Customer Information</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Download Data</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Receive Alert Message</span>
                        </div>
                    </div>
                </div>

                <!-- CIC Team Role -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-info">
                            <h3 class="role-name">CIC Team</h3>
                            <p class="role-users">5 Users</p>
                        </div>
                        <div class="role-actions">
                            <button class="btn-icon edit-role-btn" onclick="editRole('cic-team')" title="Edit Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 9.207l-3-3L12.146.146zM11.207 10.5l-3-3L2.854 13.854a.5.5 0 0 0-.146.353V16h1.793a.5.5 0 0 0 .353-.146L11.207 10.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger delete-role-btn" onclick="deleteRole('cic-team')" title="Delete Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="role-permissions">
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Full Dashboard Access</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Outage Management</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Emergency Stop</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>User Administration</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Template Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Send Notifications</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Access Residential Customer Information</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Non-Residential Customer Information</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Download Data</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Receive Alert Message</span>
                        </div>
                    </div>
                </div>

                <!-- Account Manager Role -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-info">
                            <h3 class="role-name">Account Manager</h3>
                            <p class="role-users">5 Users</p>
                        </div>
                        <div class="role-actions">
                            <button class="btn-icon edit-role-btn" onclick="editRole('account-manager')" title="Edit Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 9.207l-3-3L12.146.146zM11.207 10.5l-3-3L2.854 13.854a.5.5 0 0 0-.146.353V16h1.793a.5.5 0 0 0 .353-.146L11.207 10.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger delete-role-btn" onclick="deleteRole('account-manager')" title="Delete Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="role-permissions">
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Full Dashboard Access</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Outage Management</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Emergency Stop</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>User Administration</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Template Management</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Send Notifications</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Residential Customer Information</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Access Non-Residential Customer Information</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Download Data</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Receive Alert Message</span>
                        </div>
                    </div>
                </div>

                <!-- Corporate Affairs Role -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-info">
                            <h3 class="role-name">Corporate Affairs</h3>
                            <p class="role-users">5 Users</p>
                        </div>
                        <div class="role-actions">
                            <button class="btn-icon edit-role-btn" onclick="editRole('corporate-affairs')" title="Edit Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 9.207l-3-3L12.146.146zM11.207 10.5l-3-3L2.854 13.854a.5.5 0 0 0-.146.353V16h1.793a.5.5 0 0 0 .353-.146L11.207 10.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger delete-role-btn" onclick="deleteRole('corporate-affairs')" title="Delete Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="role-permissions">
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Full Dashboard Access</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Outage Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Emergency Stop</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>User Administration</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Template Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Send Notifications</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Residential Customer Information</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Non-Residential Customer Information</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Download Data</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Receive Alert Message</span>
                        </div>
                    </div>
                </div>

                <!-- Management Role -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-info">
                            <h3 class="role-name">Management</h3>
                            <p class="role-users">5 Users</p>
                        </div>
                        <div class="role-actions">
                            <button class="btn-icon edit-role-btn" onclick="editRole('management')" title="Edit Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 9.207l-3-3L12.146.146zM11.207 10.5l-3-3L2.854 13.854a.5.5 0 0 0-.146.353V16h1.793a.5.5 0 0 0 .353-.146L11.207 10.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger delete-role-btn" onclick="deleteRole('management')" title="Delete Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="role-permissions">
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Full Dashboard Access</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Outage Management</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Emergency Stop</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>User Administration</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Template Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Send Notifications</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Residential Customer Information</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Non-Residential Customer Information</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Download Data</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Receive Alert Message</span>
                        </div>
                    </div>
                </div>

                <!-- PSBG Engineers Role -->
                <div class="role-card">
                    <div class="role-header">
                        <div class="role-info">
                            <h3 class="role-name">PSBG Engineers</h3>
                            <p class="role-users">5 Users</p>
                        </div>
                        <div class="role-actions">
                            <button class="btn-icon edit-role-btn" onclick="editRole('psbg-engineers')" title="Edit Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 9.207l-3-3L12.146.146zM11.207 10.5l-3-3L2.854 13.854a.5.5 0 0 0-.146.353V16h1.793a.5.5 0 0 0 .353-.146L11.207 10.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger delete-role-btn" onclick="deleteRole('psbg-engineers')" title="Delete Role">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="role-permissions">
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Full Dashboard Access</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Outage Management</span>
                        </div>
                        <div class="permission-item granted">
                            <span class="permission-icon">✓</span>
                            <span>Emergency Stop</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>User Administration</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Template Management</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Send Notifications</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Residential Customer Information</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Access Non-Residential Customer Information</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Download Data</span>
                        </div>
                        <div class="permission-item denied">
                            <span class="permission-icon">✗</span>
                            <span>Receive Alert Message</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settingsSection" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Settings</h2>
            </div>

            <!-- System Settings -->
            <div class="settings-group">
                <div class="settings-group-header" onclick="toggleSettingsGroup(this)">
                    <h3 class="settings-group-title">System Settings</h3>
                    <span class="settings-group-icon">▼</span>
                </div>
                <div class="settings-group-content expanded">
                    <div class="settings-row">
                        <div class="setting-item">
                            <label class="setting-label">Data Retention Period (Days)</label>
                            <input type="number" class="setting-input integer-only" value="16" min="1" max="365" oninput="validateIntegerInput(this)" required>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Inter-update Interval (Minutes)</label>
                            <input type="number" class="setting-input integer-only" value="30" min="1" max="1440" oninput="validateIntegerInput(this)" required>
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">No more than xx times per incident</label>
                            <input type="number" class="setting-input integer-only" value="10" min="1" max="100" oninput="validateIntegerInput(this)" required>
                        </div>
                    </div>
                    
                    <div class="settings-row">
                        <div class="setting-group-vertical">
                            <label class="setting-label">Internal/External Communication</label>
                            <div class="toggle-group">
                                <div class="toggle-item">
                                    <div class="toggle-switch active" id="emailNotifications" onclick="toggleCommunicationSetting(this, 'internal')">
                                        <div class="toggle-label">ON</div>
                                    </div>
                                    <span class="toggle-text">Enable internal Communication (Email)</span>
                                </div>
                                <div class="toggle-item">
                                    <div class="toggle-switch active" id="smsNotifications" onclick="toggleSetting(this)">
                                        <div class="toggle-label">ON</div>
                                    </div>
                                    <span class="toggle-text">Enable external Communication (SMS)</span>
                                </div>
                                <div class="toggle-item">
                                    <div class="toggle-switch" id="pushNotifications" onclick="toggleSetting(this)">
                                        <div class="toggle-label">OFF</div>
                                    </div>
                                    <span class="toggle-text">Enable Push Notifications</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button class="btn btn-primary" id="saveSettingsBtn" onclick="saveSystemSettings()">Save</button>
                        <button class="btn btn-secondary" id="resetSettingsBtn" onclick="cancelSystemSettings()">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Trigger Mode -->
            <div class="settings-group">
                <div class="settings-group-header" onclick="toggleSettingsGroup(this)">
                    <h3 class="settings-group-title">Trigger Mode</h3>
                    <span class="settings-group-icon">▶</span>
                </div>
                <div class="settings-group-content">
                    <div class="trigger-settings">
                        <div class="trigger-item">
                            <div class="trigger-info">
                                <div class="trigger-header">
                                    <h4 class="trigger-title">Auto Trigger:</h4>
                                    <div class="toggle-switch active" onclick="toggleTriggerSetting(this, 'auto')">
                                        <div class="toggle-label">ON</div>
                                    </div>
                                </div>
                                <p class="trigger-description">Automatically progress through stages</p>
                            </div>
                        </div>
                        
                        <div class="trigger-item">
                            <div class="trigger-info">
                                <div class="trigger-header">
                                    <h4 class="trigger-title">Manual Trigger:</h4>
                                    <div class="toggle-switch" onclick="toggleTriggerSetting(this, 'manual')">
                                        <div class="toggle-label">OFF</div>
                                    </div>
                                </div>
                                <p class="trigger-description">User manually trigger for each stage</p>
                            </div>
                        </div>
                        
                        <div class="trigger-item">
                            <div class="trigger-info">
                                <div class="trigger-header">
                                    <h4 class="trigger-title">Extreme Weather Mode</h4>
                                    <div class="toggle-switch" id="extremeWeatherMode" onclick="toggleExtremeWeatherSetting(this)">
                                        <div class="toggle-label">OFF</div>
                                    </div>
                                </div>
                                <p class="trigger-description">User manually trigger for each stage</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Weather Thresholds (shown when extreme weather is enabled) -->
                    <div class="settings-row" style="margin-top: 20px;">
                        <div class="setting-item">
                            <label class="setting-label">Temperature Threshold (°C)</label>
                            <input type="number" class="setting-input integer-only" id="weatherThresholdTemp" value="35" min="0" max="50" oninput="validateIntegerInput(this)" placeholder="e.g., 35">
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Wind Speed Threshold (km/h)</label>
                            <input type="number" class="setting-input integer-only" id="weatherThresholdWind" value="60" min="0" max="200" oninput="validateIntegerInput(this)" placeholder="e.g., 60">
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button class="btn btn-primary" onclick="saveTriggerModeSettings()">Save</button>
                        <button class="btn btn-secondary" onclick="cancelTriggerModeSettings()">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Delay & Control -->
            <div class="settings-group">
                <div class="settings-group-header" onclick="toggleSettingsGroup(this)">
                    <h3 class="settings-group-title">Delay & Control</h3>
                    <span class="settings-group-icon">▶</span>
                </div>
                <div class="settings-group-content">
                    <div class="delay-settings">
                        <div class="settings-row">
                            <div class="setting-item">
                                <label class="setting-label">Planned Outage Delay (Minutes)</label>
                                <input type="number" class="setting-input integer-only" id="plannedOutageDelay" value="30" min="1" max="1440" oninput="validateIntegerInput(this)" required>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">Unplanned Outage Delay (Minutes)</label>
                                <input type="number" class="setting-input integer-only" id="unplannedOutageDelay" value="15" min="1" max="1440" oninput="validateIntegerInput(this)" required>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">Emergency Delay (Minutes)</label>
                                <input type="number" class="setting-input integer-only" id="emergencyDelay" value="5" min="1" max="1440" oninput="validateIntegerInput(this)" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button class="btn btn-primary" onclick="saveDelayControlSettings()">Save</button>
                        <button class="btn btn-secondary" onclick="cancelDelayControlSettings()">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Alert Message Triggering -->
            <div class="settings-group">
                <div class="settings-group-header" onclick="toggleSettingsGroup(this)">
                    <h3 class="settings-group-title">Alert Message Triggering</h3>
                    <span class="settings-group-icon">▶</span>
                </div>
                <div class="settings-group-content">
                    <div class="alert-settings">
                        <div class="alert-description">
                            <p>An alert message will be triggered if no second notification is received within 
                            <input type="number" class="inline-input integer-only" id="emergencyDelay" value="20" min="1" max="60" oninput="validateIntegerInput(this)" required> 
                            minute after the first notification has been sent.</p>
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button class="btn btn-primary" onclick="saveAlertTriggeringSettings()">Save</button>
                        <button class="btn btn-secondary" onclick="cancelAlertTriggeringSettings()">Cancel</button>
                    </div>
                </div>
            </div>
        </section>
        </main>
    </div>

    <!-- Update Message Popup -->
    <div id="updateMessage" class="update-message">
        <span id="updateMessageText">User role updated successfully!</span>
        <button class="close-btn" onclick="hideUpdateMessage()">×</button>
    </div>

    <!-- Add New User Modal -->
    <div id="addUserModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add New User</div>
                <button class="modal-close" onclick="hideAddUserModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">Staff ID<span class="required-asterisk">*</span></label>
                        <input type="text" class="form-input" id="userId" placeholder="Enter Staff ID (E.g. 93313)" onchange="autoFillUserData(this.value)" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-input" id="userName" placeholder="Enter Name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="userEmail" placeholder="Enter Email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role<span class="required-asterisk">*</span></label>
                        <div class="multi-select-dropdown" id="userRole">
                            <button class="multi-select-button" type="button" onclick="toggleMultiSelect('userRole')">
                                <span id="userRoleText">Select Role(s)</span>
                                <span class="multi-select-dropdown-arrow">▼</span>
                            </button>
                            <div class="multi-select-options">
                                <div class="multi-select-option">
                                    <input type="checkbox" id="user_role_system_admin" value="System Admin" onchange="updateUserRoleSelection()">
                                    <label for="user_role_system_admin">System Admin</label>
                                </div>
                                <div class="multi-select-option">
                                    <input type="checkbox" id="user_role_cic_team" value="CIC Team" onchange="updateUserRoleSelection()">
                                    <label for="user_role_cic_team">CIC Team</label>
                                </div>
                                <div class="multi-select-option">
                                    <input type="checkbox" id="user_role_account_manager" value="Account Manager" onchange="updateUserRoleSelection()">
                                    <label for="user_role_account_manager">Account Manager</label>
                                </div>
                                <div class="multi-select-option">
                                    <input type="checkbox" id="user_role_corporate_affairs" value="Corporate Affairs" onchange="updateUserRoleSelection()">
                                    <label for="user_role_corporate_affairs">Corporate Affairs</label>
                                </div>
                                <div class="multi-select-option">
                                    <input type="checkbox" id="user_role_management" value="Management" onchange="updateUserRoleSelection()">
                                    <label for="user_role_management">Management</label>
                                </div>
                                <div class="multi-select-option">
                                    <input type="checkbox" id="user_role_psbg_engineers" value="PSBG Engineers" onchange="updateUserRoleSelection()">
                                    <label for="user_role_psbg_engineers">PSBG Engineers</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancelUserBtn" class="btn-modal btn-modal-secondary" onclick="hideAddUserModal()">Cancel</button>
                <button id="saveUserBtn" class="btn-modal btn-modal-primary" onclick="createNewUser()">Create</button>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div id="warningModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">!</div>
                <div class="modal-title">Cannot Delete Active User</div>
            </div>
            <div class="modal-body">
                <p>You cannot delete a user who is currently active. Please set the user status to "Inactive" before attempting to delete.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-primary" onclick="hideWarningModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Role Delete Confirmation Modal -->
    <div id="roleDeleteModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" style="background-color: #dc3545; color: white;">⚠</div>
                <div class="modal-title">Confirm Role Deletion</div>
            </div>
            <div class="modal-body">
                <p id="roleDeleteMessage">Are you sure you want to delete this role?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-danger" onclick="confirmRoleDeletion()">Delete</button>
                <button class="btn-modal btn-modal-secondary" onclick="hideRoleDeleteModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- User Delete Confirmation Modal -->
    <div id="userDeleteModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" style="background-color: #dc3545; color: white;">⚠</div>
                <div class="modal-title">Confirm User Deletion</div>
            </div>
            <div class="modal-body">
                <p id="userDeleteMessage">Are you sure you want to delete this user?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-danger" onclick="confirmUserDeletion()">Yes</button>
                <button class="btn-modal btn-modal-secondary" onclick="hideUserDeleteModal()">No</button>
            </div>
        </div>
    </div>

    <!-- Role Assignment Warning Modal -->
    <div id="roleAssignmentWarningModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">!</div>
                <div class="modal-title">Cannot Delete Role</div>
            </div>
            <div class="modal-body">
                <p id="roleAssignmentWarningMessage">Please assign a role for User: Arthur Chan before deleting this role</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-primary" onclick="hideRoleAssignmentWarningModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Communication Toggle Acknowledgment Modal -->
    <div id="communicationToggleModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" style="background-color: #17a2b8; color: white;">ℹ</div>
                <div class="modal-title">Communication Setting</div>
            </div>
            <div class="modal-body">
                <p id="communicationToggleMessage">Turning off the Internal Communication will not affect the ongoing notification</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-primary" onclick="confirmCommunicationToggle()">OK</button>
                <button class="btn-modal btn-modal-secondary" onclick="cancelCommunicationToggle()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Extreme Weather Mode Acknowledgment Modal -->
    <div id="extremeWeatherModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" style="background-color: #17a2b8; color: white;">ℹ</div>
                <div class="modal-title">Extreme Weather Mode</div>
            </div>
            <div class="modal-body">
                <p>Turning on/off the "Extreme Weather Mode" will not affect the ongoing notification</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-primary" onclick="confirmExtremeWeatherToggle()">OK</button>
                <button class="btn-modal btn-modal-secondary" onclick="cancelExtremeWeatherToggle()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadOverlay" class="bulk-upload-overlay">
        <div class="bulk-upload-modal">
            <div class="bulk-modal-header">
                <h3 class="bulk-modal-title">Customer Management by Bulk Upload</h3>
                <button class="bulk-modal-close" onclick="hideBulkUploadModal()">×</button>
            </div>
            <div class="bulk-modal-content">
                <p class="bulk-modal-description">
                    Download the template file and after filling the template, you can import for Bulk Upload.
                </p>
                <div class="bulk-modal-buttons">
                    <button class="btn-download-template" onclick="downloadBulkTemplate()">Download Template</button>
                    <button class="btn-upload-file" onclick="selectBulkFile()">Upload</button>
                    <input type="file" id="bulkFileInput" class="hidden-bulk-file-input" accept=".csv" onchange="handleBulkFileSelect(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- User Bulk Upload Modal -->
    <div id="userBulkUploadOverlay" class="bulk-upload-overlay">
        <div class="bulk-upload-modal">
            <div class="bulk-modal-header">
                <h3 class="bulk-modal-title">Add New User by Bulk Upload</h3>
                <button class="bulk-modal-close" onclick="hideUserBulkUploadModal()">×</button>
            </div>
            <div class="bulk-modal-content">
                <p class="bulk-modal-description">
                    Download the template file and after filling the template, you can import for Bulk Upload.
                </p>
                <div class="bulk-modal-buttons">
                    <button class="btn-download-template" onclick="downloadUserBulkTemplate()">Download Template</button>
                    <button class="btn-upload-file" onclick="selectUserBulkFile()">Bulk Upload</button>
                    <input type="file" id="userBulkFileInput" class="hidden-bulk-file-input" accept=".csv" onchange="handleUserBulkFileSelect(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Import Summary Modal -->
    <div id="importSummaryOverlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Import Summary</div>
                <button class="modal-close" onclick="hideImportSummaryModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="import-summary-content">
                    <p class="import-summary-message" id="importSummaryMessage">Users are imported to system successfully.</p>
                    
                    <div class="import-summary-stats">
                        <div class="import-stat success">
                            <span class="import-stat-label">Success:</span>
                            <span class="import-stat-value" id="successCount">0</span>
                        </div>
                        <div class="import-stat failed">
                            <span class="import-stat-label">Failed:</span>
                            <span class="import-stat-value" id="failedCount">0</span>
                        </div>
                    </div>
                    
                    <div class="import-errors" id="importErrors" style="display: none;">
                        <div class="import-errors-list" id="importErrorsList">
                            <!-- Error messages will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-primary" onclick="hideImportSummaryModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Customer Import Summary Modal -->
    <div id="customerImportSummaryOverlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Customer Import Summary</div>
                <button class="modal-close" onclick="hideCustomerImportSummaryModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="import-summary-content">
                    <p class="import-summary-message" id="customerImportSummaryMessage">Customer preferences are imported to system successfully.</p>
                    
                    <div class="import-summary-stats">
                        <div class="import-stat success">
                            <span class="import-stat-label">Success:</span>
                            <span class="import-stat-value" id="customerSuccessCount">0</span>
                        </div>
                        <div class="import-stat failed">
                            <span class="import-stat-label">Failed:</span>
                            <span class="import-stat-value" id="customerFailedCount">0</span>
                        </div>
                    </div>
                    
                    <div class="import-errors" id="customerImportErrors" style="display: none;">
                        <div class="import-errors-list" id="customerImportErrorsList">
                            <!-- Error messages will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-primary" onclick="hideCustomerImportSummaryModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Role Management Modal -->
    <div id="roleModalOverlay" class="role-modal-overlay">
        <div class="role-modal">
            <div class="role-modal-header">
                <h3 class="role-modal-title" id="roleModalTitle">Create New Role</h3>
                <button class="role-modal-close" onclick="hideRoleModal()">×</button>
            </div>
            <div class="role-modal-body">
                <form id="roleForm">
                    <div class="form-group">
                        <label for="roleName">Role Name</label>
                        <input type="text" id="roleName" name="roleName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="roleDescription">Role Description</label>
                        <textarea id="roleDescription" name="roleDescription" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical;" placeholder="Enter role description..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #2c5aa0; font-weight: 600; margin-bottom: 15px;">Select Permissions</label>
                        <div class="permissions-grid">
                            <div class="permission-item-modal selected" data-permission="dashboard" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="dashboard" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Full Dashboard Access</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="outage" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="outage" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Outage Management</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="emergency" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="emergency" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Emergency Stop</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="user_admin" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="user_admin" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>User Administration</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="template" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="template" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Template Management</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="notifications" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="notifications" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Send Notifications</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="residential" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="residential" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Access Residential Customer Information</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="non_residential" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="non_residential" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Access Non-Residential Customer Information</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="download" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="download" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Download Data</span>
                            </div>
                            <div class="permission-item-modal selected" data-permission="alerts" onclick="togglePermission(this)">
                                <input type="checkbox" name="permissions" value="alerts" checked style="display: none;">
                                <span class="permission-icon-modal">✓</span>
                                <span>Receive Alert Message</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="role-modal-footer">
                <button id="saveRoleBtn" class="btn btn-primary" onclick="saveRole()">Create</button>
                <button id="cancelRoleBtn" class="btn btn-secondary" onclick="hideRoleModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Opt-Out Exception Report Overlay -->
    <div id="reportOverlay" class="report-overlay">
        <div class="report-modal">
            <div class="report-header">
                <h2 class="report-title">Opt-out exception report</h2>
                <button class="report-close" onclick="hideOptOutReport()">×</button>
            </div>
            <div class="report-content">
                <div class="report-filters">
                    <select class="date-filter" id="dateFilter" onchange="filterReportData()">
                        <option value="today">Today</option>
                        <option value="7days">Last 7 Days</option>
                        <option value="30days">Last 30 Days</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="text" class="customer-search" id="customerSearch" placeholder="Search by customer account number..." oninput="filterReportData()">
                </div>
                <div class="report-table-container">
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Customer Account</th>
                                <th>Reply Time</th>
                                <th>Reply Message</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <tr data-date="2025-09-27" data-account="A012358056">
                                <td class="customer-account">A012358056</td>
                                <td class="reply-time">2025/09/27, 12:24:30</td>
                                <td class="reply-message">STOP</td>
                            </tr>
                            <tr data-date="2025-09-26" data-account="A044358656">
                                <td class="customer-account">A044358656</td>
                                <td class="reply-time">2025/09/26, 17:14:00</td>
                                <td class="reply-message">取消</td>
                            </tr>
                            <tr data-date="2025-10-20" data-account="A055567890">
                                <td class="customer-account">A055567890</td>
                                <td class="reply-time">2025/10/20, 09:15:22</td>
                                <td class="reply-message">UNSUBSCRIBE</td>
                            </tr>
                            <tr data-date="2025-10-19" data-account="A066778901">
                                <td class="customer-account">A066778901</td>
                                <td class="reply-time">2025/10/19, 14:33:45</td>
                                <td class="reply-message">停止</td>
                            </tr>
                            <tr data-date="2025-10-18" data-account="A077889012">
                                <td class="customer-account">A077889012</td>
                                <td class="reply-time">2025/10/18, 16:42:11</td>
                                <td class="reply-message">STOP</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Edit user functionality
        function editUser(button) {
            const row = button.closest('tr');
            const roleCell = row.querySelector('.role-cell');
            const actionsCell = row.querySelector('.table-actions');
            const currentRoles = roleCell.textContent.trim();
            
            // Store original values
            row.setAttribute('data-original-role', currentRoles);
            
            // Add edit mode styling
            row.classList.add('edit-mode');
            
            // Parse current roles (split by " + " if multiple)
            const roleArray = currentRoles.split(' + ').map(role => role.trim());
            
            // Create unique ID for this edit dropdown
            const dropdownId = `editRoleDropdown_${Date.now()}`;
            
            // Replace role cell with multiple selection dropdown
            roleCell.innerHTML = `
                <div class="multi-select-dropdown" id="${dropdownId}">
                    <button class="multi-select-button" onclick="toggleMultiSelect('${dropdownId}')" type="button">
                        <span id="${dropdownId}_text">${currentRoles}</span>
                        <span class="multi-select-dropdown-arrow">▼</span>
                    </button>
                    <div class="multi-select-options">
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_system_admin" value="System Admin" ${roleArray.includes('System Admin') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_system_admin">System Admin</label>
                        </div>
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_cic_team" value="CIC Team" ${roleArray.includes('CIC Team') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_cic_team">CIC Team</label>
                        </div>
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_account_manager" value="Account Manager" ${roleArray.includes('Account Manager') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_account_manager">Account Manager</label>
                        </div>
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_corporate_affairs" value="Corporate Affairs" ${roleArray.includes('Corporate Affairs') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_corporate_affairs">Corporate Affairs</label>
                        </div>
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_management" value="Management" ${roleArray.includes('Management') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_management">Management</label>
                        </div>
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_psbg_engineers" value="PSBG Engineers" ${roleArray.includes('PSBG Engineers') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_psbg_engineers">PSBG Engineers</label>
                        </div>
                        <div class="multi-select-option">
                            <input type="checkbox" id="${dropdownId}_user" value="User" ${roleArray.includes('User') ? 'checked' : ''} onchange="updateEditRoleText('${dropdownId}')">
                            <label for="${dropdownId}_user">User</label>
                        </div>
                    </div>
                </div>
            `;
            
            // Replace actions with Save/Cancel buttons
            actionsCell.innerHTML = `
                <div class="save-cancel-buttons">
                    <button class="btn-save" onclick="saveUser(this)">Save</button>
                    <button class="btn-cancel" onclick="cancelEdit(this)">Cancel</button>
                </div>
            `;
        }

        function saveUser(button) {
            const row = button.closest('tr');
            const roleCell = row.querySelector('.role-cell');
            const actionsCell = row.querySelector('.table-actions');
            
            // Get selected roles from the multi-select dropdown
            const checkboxes = roleCell.querySelectorAll('input[type="checkbox"]:checked');
            const selectedRoles = Array.from(checkboxes).map(cb => cb.value);
            
            // Validate that at least one role is selected
            if (selectedRoles.length === 0) {
                showUpdateMessage('Please select at least one role', 'error');
                return;
            }
            
            const newRoleDisplay = selectedRoles.join(' + ');
            
            // Update the role in the cell
            roleCell.textContent = newRoleDisplay;
            
            // Update data attribute (use lowercase and include all roles for filtering)
            row.setAttribute('data-role', selectedRoles.join(' + ').toLowerCase());
            
            // Remove edit mode styling
            row.classList.remove('edit-mode');
            
            // Restore original actions
            actionsCell.innerHTML = `
                <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                <div class="toggle-switch ${row.getAttribute('data-status') === 'active' ? 'active' : ''}"></div>
            `;
            
            // Re-attach toggle switch functionality
            const toggleSwitch = actionsCell.querySelector('.toggle-switch');
            toggleSwitch.addEventListener('click', function() {
                toggleUserStatus(this);
            });
            
            // Show update message
            showUpdateMessage('User role updated successfully!');
        }

        function cancelEdit(button) {
            const row = button.closest('tr');
            const roleCell = row.querySelector('.role-cell');
            const actionsCell = row.querySelector('.table-actions');
            const originalRole = row.getAttribute('data-original-role');
            
            // Restore original role
            roleCell.textContent = originalRole;
            
            // Remove edit mode styling
            row.classList.remove('edit-mode');
            
            // Restore original actions
            actionsCell.innerHTML = `
                <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                <div class="toggle-switch ${row.getAttribute('data-status') === 'active' ? 'active' : ''}"></div>
            `;
            
            // Re-attach toggle switch functionality
            const toggleSwitch = actionsCell.querySelector('.toggle-switch');
            toggleSwitch.addEventListener('click', function() {
                toggleUserStatus(this);
            });
        }

        function showUpdateMessage(message, type) {
            console.log('🔔 showUpdateMessage called:', { message, type, timestamp: new Date().toISOString() });
            
            const messageElement = document.getElementById('updateMessage');
            const messageText = document.getElementById('updateMessageText');
            
            console.log('📍 Message elements:', { 
                messageElement: messageElement ? 'found' : 'NOT FOUND',
                messageText: messageText ? 'found' : 'NOT FOUND',
                currentText: messageText ? messageText.textContent : 'N/A',
                currentClasses: messageElement ? messageElement.className : 'N/A'
            });
            
            messageText.textContent = message;
            console.log('✏️ Message text updated to:', message);
            
            // Check if any overlay is currently visible
            const isOverlayVisible = document.querySelector('.role-modal-overlay.show') ||
                                   document.querySelector('.bulk-upload-overlay.show') ||
                                   document.querySelector('.report-overlay.show') ||
                                   document.querySelector('.modal-overlay.show');
            
            console.log('🔍 Overlay check:', {
                isOverlayVisible: !!isOverlayVisible,
                overlayType: isOverlayVisible ? isOverlayVisible.id : 'none'
            });
            
            // Apply appropriate styling
            messageElement.classList.remove('success', 'error', 'overlay-mode');
            console.log('🧹 Cleared classes: success, error, overlay-mode');
            
            if (isOverlayVisible) {
                messageElement.classList.add('overlay-mode');
                console.log('➕ Added overlay-mode class');
            }
            
            if (type === 'error') {
                messageElement.classList.add('error');
                console.log('➕ Added error class');
            } else if (type === 'success') {
                messageElement.classList.add('success');
                console.log('➕ Added success class');
            }
            
            messageElement.classList.add('show');
            console.log('✅ Added show class, final classes:', messageElement.className);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                console.log('⏰ 3 seconds elapsed, calling hideUpdateMessage');
                hideUpdateMessage();
            }, 3000);
        }

        function hideUpdateMessage() {
            console.log('🚫 hideUpdateMessage called:', new Date().toISOString());
            
            const messageElement = document.getElementById('updateMessage');
            const messageText = document.getElementById('updateMessageText');
            
            console.log('📍 Before hide:', {
                messageElement: messageElement ? 'found' : 'NOT FOUND',
                currentText: messageText ? messageText.textContent : 'N/A',
                currentClasses: messageElement ? messageElement.className : 'N/A'
            });
            
            messageElement.classList.remove('show', 'success', 'error', 'overlay-mode');
            
            console.log('✅ After hide, classes removed. Final classes:', messageElement.className);
            console.log('📝 Text content still showing:', messageText ? messageText.textContent : 'N/A');
        }

        // Delete user functionality
        let userToDelete = null; // Store the row and userName temporarily

        function deleteUser(button) {
            const row = button.closest('tr');
            const status = row.getAttribute('data-status');
            const userName = row.querySelector('td:first-child').textContent;
            
            if (status === 'active') {
                // Show warning modal for active users
                showWarningModal();
            } else {
                // Show confirmation modal for inactive users
                userToDelete = { row: row, userName: userName };
                document.getElementById('userDeleteMessage').textContent = `Are you sure you want to delete user "${userName}"?`;
                showUserDeleteModal();
            }
        }

        function confirmUserDeletion() {
            if (userToDelete) {
                // Remove the row from the table
                userToDelete.row.remove();
                
                // Show success message
                showUpdateMessage(`User "${userToDelete.userName}" has been deleted successfully!`);
                
                // Reset
                userToDelete = null;
            }
            hideUserDeleteModal();
        }

        function showUserDeleteModal() {
            const modal = document.getElementById('userDeleteModal');
            modal.classList.add('show');
        }

        function hideUserDeleteModal() {
            const modal = document.getElementById('userDeleteModal');
            modal.classList.remove('show');
        }

        function confirmDeleteUser(row, userName) {
            // Remove the row from the table
            row.remove();
            
            // Show success message
            showUpdateMessage(`User "${userName}" has been deleted successfully!`);
        }

        function showWarningModal() {
            const modal = document.getElementById('warningModal');
            modal.classList.add('show');
        }

        // Add New User Modal Functions
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('show');
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.remove('show');
            // Reset form
            document.getElementById('addUserForm').reset();
            
            // Reset role dropdown text
            document.getElementById('addUserRoleText').textContent = 'Select Roles';
            
            // Uncheck all role checkboxes
            document.querySelectorAll('#addUserRoleDropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function autoFillUserData(staffId) {
            const nameField = document.getElementById('userName');
            const emailField = document.getElementById('userEmail');
            
            // Auto-fill demonstration data based on Staff ID
            if (staffId === '93313') {
                nameField.value = 'Arthur Chan';
                emailField.value = 'arthur.chan@clp.com';
            } else {
                // Clear fields if different staff ID
                nameField.value = '';
                emailField.value = '';
            }
        }

        function createNewUser() {
            const form = document.getElementById('addUserForm');
            const staffId = document.getElementById('userId').value;
            const userName = document.getElementById('userName').value;
            const userEmail = document.getElementById('userEmail').value;

            // Get selected roles from multi-select dropdown
            const roleCheckboxes = document.querySelectorAll('#userRole input[type="checkbox"]:checked');
            const selectedRoles = Array.from(roleCheckboxes).map(cb => cb.value);

            // Validate form
            if (!staffId || !userName || !userEmail || selectedRoles.length === 0) {
                showUpdateMessage('Please fill in all required fields', 'error');
                return;
            }

            // Check for duplicate user names
            if (isDuplicateUser(userName)) {
                showUpdateMessage('User is already on the list', 'error');
                return;
            }

            const roleDisplay = selectedRoles.join(', ');

            // Create new user data object - new users are always Active
            const newUser = {
                staffId: staffId,
                name: userName,
                email: userEmail,
                role: roleDisplay,
                status: 'active',  // Always active for new users
                lastLogin: 'Never'
            };

            // In a real application, you would send this data to the server
            console.log('Creating new user:', newUser);
            
            // Add the new user to the table (demonstration)
            addUserToTable(newUser);
            
            // Close modal and show success message
            hideAddUserModal();
            showUpdateMessage(`User "${userName}" created successfully!`, 'success');
        }

        function isDuplicateUser(userName) {
            const existingUsers = document.querySelectorAll('.user-table tbody tr');
            const normalizedNewName = userName.toLowerCase().trim();
            
            for (let row of existingUsers) {
                const existingName = row.querySelector('td:first-child').textContent.toLowerCase().trim();
                if (existingName === normalizedNewName) {
                    return true;
                }
            }
            return false;
        }

        function addUserToTable(user) {
            const tableBody = document.querySelector('.user-table tbody');
            const newRow = document.createElement('tr');
            newRow.setAttribute('data-status', user.status);
            newRow.setAttribute('data-role', user.role.toLowerCase());
            newRow.setAttribute('data-name', user.name.toLowerCase());
            newRow.setAttribute('data-email', user.email);
            newRow.setAttribute('data-lastlogin', user.lastLogin);
            
            newRow.innerHTML = `
                <td>${user.name}</td>
                <td>${user.email}</td>
                <td class="role-cell">${user.role}</td>
                <td><span class="status-badge status-active">Active</span></td>
                <td>${user.lastLogin}</td>
                <td>
                    <div class="table-actions">
                        <button class="action-btn edit-btn" onclick="editUser(this)">✏️</button>
                        <button class="action-btn delete-btn" onclick="deleteUser(this)">🗑️</button>
                        <div class="toggle-switch active" title="Active/Inactive"></div>
                    </div>
                </td>
            `;
            
            // Add event listener to the new toggle switch
            const toggleSwitch = newRow.querySelector('.toggle-switch');
            toggleSwitch.addEventListener('click', function() {
                toggleUserStatus(this);
            });
            
            // Insert at the beginning of the table
            tableBody.insertBefore(newRow, tableBody.firstChild);
        }

        function hideWarningModal() {
            const modal = document.getElementById('warningModal');
            modal.classList.remove('show');
        }

        // Close modal when clicking outside
        document.getElementById('warningModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideWarningModal();
            }
        });

        document.getElementById('userDeleteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideUserDeleteModal();
            }
        });

        document.getElementById('addUserModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAddUserModal();
            }
        });

        // Table sorting functionality
        let currentSort = { column: null, direction: null };

        function sortTable(column) {
            const table = document.querySelector('tbody');
            const rows = Array.from(table.querySelectorAll('tr:not(.hidden)'));
            const allRows = Array.from(table.querySelectorAll('tr'));
            const headers = document.querySelectorAll('th.sortable');
            
            // Determine sort direction
            let direction = 'asc';
            if (currentSort.column === column && currentSort.direction === 'asc') {
                direction = 'desc';
            }
            
            // Update header classes
            headers.forEach(header => {
                header.classList.remove('asc', 'desc');
            });
            
            const currentHeader = document.querySelector(`th[data-column="${column}"]`);
            currentHeader.classList.add(direction);
            
            // Sort the visible rows
            rows.sort((a, b) => {
                let aVal, bVal;
                
                switch(column) {
                    case 'name':
                        aVal = a.getAttribute('data-name');
                        bVal = b.getAttribute('data-name');
                        break;
                    case 'email':
                        aVal = a.getAttribute('data-email');
                        bVal = b.getAttribute('data-email');
                        break;
                    case 'role':
                        aVal = a.getAttribute('data-role');
                        bVal = b.getAttribute('data-role');
                        break;
                    case 'status':
                        aVal = a.getAttribute('data-status');
                        bVal = b.getAttribute('data-status');
                        break;
                    case 'lastlogin':
                        aVal = new Date(a.getAttribute('data-lastlogin'));
                        bVal = new Date(b.getAttribute('data-lastlogin'));
                        break;
                    default:
                        return 0;
                }
                
                // Handle date comparison
                if (column === 'lastlogin') {
                    if (direction === 'asc') {
                        return aVal - bVal;
                    } else {
                        return bVal - aVal;
                    }
                }
                
                // Handle string comparison
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'asc') {
                    return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
                } else {
                    return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
                }
            });
            
            // Re-append sorted rows, maintaining hidden rows in their original positions
            const hiddenRows = allRows.filter(row => row.classList.contains('hidden'));
            
            // Clear table
            table.innerHTML = '';
            
            // Add sorted visible rows and hidden rows back
            let visibleIndex = 0;
            allRows.forEach(originalRow => {
                if (originalRow.classList.contains('hidden')) {
                    table.appendChild(originalRow);
                } else {
                    if (visibleIndex < rows.length) {
                        table.appendChild(rows[visibleIndex]);
                        visibleIndex++;
                    }
                }
            });
            
            // Update current sort state
            currentSort = { column, direction };
            
            // Re-attach event listeners for toggle switches
            attachToggleListeners();
        }

        function attachToggleListeners() {
            document.querySelectorAll('.user-table .toggle-switch').forEach(toggle => {
                // Remove existing event listeners by cloning the element
                const newToggle = toggle.cloneNode(true);
                toggle.parentNode.replaceChild(newToggle, toggle);
                
                // Add new event listener
                newToggle.addEventListener('click', function() {
                    toggleUserStatus(this);
                });
            });
        }

        // Toggle user status functionality
        function toggleUserStatus(toggleElement) {
            const row = toggleElement.closest('tr');
            const statusBadge = row.querySelector('.status-badge');
            
            if (!statusBadge) {
                console.error('Status badge not found!');
                return;
            }
            
            const currentStatus = row.getAttribute('data-status');
            
            // Toggle the visual switch
            toggleElement.classList.toggle('active');
            
            // Add a brief transition effect
            statusBadge.style.transition = 'all 0.3s ease';
            
            // Update status based on toggle state
            if (toggleElement.classList.contains('active')) {
                // Set to Active
                row.setAttribute('data-status', 'active');
                statusBadge.textContent = 'Active';
                statusBadge.className = 'status-badge status-active';
                console.log('Status changed to Active');
            } else {
                // Set to Inactive
                row.setAttribute('data-status', 'inactive');
                statusBadge.textContent = 'Inactive';
                statusBadge.className = 'status-badge status-inactive';
                console.log('Status changed to Inactive');
            }
            
            // Add a subtle flash effect to show the change
            statusBadge.style.transform = 'scale(1.1)';
            setTimeout(() => {
                statusBadge.style.transform = 'scale(1)';
            }, 200);
            
            // Show update message
            const userName = row.querySelector('td:first-child').textContent;
            const newStatus = row.getAttribute('data-status');
            showUpdateMessage(`User "${userName}" status updated to ${newStatus.charAt(0).toUpperCase() + newStatus.slice(1)}!`);
        }

        // Multiple Selection Dropdown Functions
        function toggleMultiSelect(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const button = dropdown.querySelector('.multi-select-button');
            const options = dropdown.querySelector('.multi-select-options');
            const arrow = dropdown.querySelector('.multi-select-dropdown-arrow');
            
            const isOpen = options.classList.contains('show');
            
            // Close all other dropdowns
            document.querySelectorAll('.multi-select-options.show').forEach(opt => {
                opt.classList.remove('show');
                opt.closest('.multi-select-dropdown').querySelector('.multi-select-button').classList.remove('open');
                opt.closest('.multi-select-dropdown').querySelector('.multi-select-dropdown-arrow').classList.remove('open');
            });
            
            if (!isOpen) {
                options.classList.add('show');
                button.classList.add('open');
                arrow.classList.add('open');
            }
        }

        function updateRoleFilter() {
            const selectedRoles = [];
            const checkboxes = document.querySelectorAll('#roleFilter input[type="checkbox"]:checked');
            
            checkboxes.forEach(checkbox => {
                selectedRoles.push(checkbox.value);
            });
            
            // Update button text
            const buttonText = document.getElementById('roleFilterText');
            const selectedCount = selectedRoles.length;
            
            if (selectedCount === 0) {
                buttonText.innerHTML = 'All Roles';
            } else if (selectedCount === 1) {
                const selectedLabel = document.querySelector(`label[for="${checkboxes[0].id}"]`).textContent;
                buttonText.innerHTML = selectedLabel;
            } else {
                buttonText.innerHTML = `All Roles <span class="multi-select-selected-count">${selectedCount}</span>`;
            }
            
            // Apply filter
            filterUsers();
        }

        function updateUserRoleSelection() {
            const selectedRoles = [];
            const checkboxes = document.querySelectorAll('#userRole input[type="checkbox"]:checked');
            
            checkboxes.forEach(checkbox => {
                selectedRoles.push(checkbox.value);
            });
            
            // Update button text
            const buttonText = document.getElementById('userRoleText');
            const selectedCount = selectedRoles.length;
            
            if (selectedCount === 0) {
                buttonText.textContent = 'Select Role(s)';
            } else if (selectedCount === 1) {
                const selectedLabel = document.querySelector(`label[for="${checkboxes[0].id}"]`).textContent;
                buttonText.textContent = selectedLabel;
            } else {
                buttonText.innerHTML = `Multiple Roles <span class="multi-select-selected-count">${selectedCount}</span>`;
            }
        }

        function updateEditRoleText(dropdownId) {
            const selectedRoles = [];
            const checkboxes = document.querySelectorAll(`#${dropdownId} input[type="checkbox"]:checked`);
            
            checkboxes.forEach(checkbox => {
                selectedRoles.push(checkbox.value);
            });
            
            // Update button text
            const buttonText = document.getElementById(`${dropdownId}_text`);
            
            if (selectedRoles.length === 0) {
                buttonText.textContent = 'Select Roles';
            } else {
                buttonText.textContent = selectedRoles.join(' + ');
            }
        }

        function updateAddUserRoleText() {
            const selectedRoles = [];
            const checkboxes = document.querySelectorAll('#addUserRoleDropdown input[type="checkbox"]:checked');
            
            checkboxes.forEach(checkbox => {
                selectedRoles.push(checkbox.value);
            });
            
            // Update button text
            const buttonText = document.getElementById('addUserRoleText');
            
            if (selectedRoles.length === 0) {
                buttonText.textContent = 'Select Roles';
            } else {
                buttonText.textContent = selectedRoles.join(' + ');
            }
        }

        // Filter functionality
        function filterUsers() {
            const selectedRoles = Array.from(document.querySelectorAll('#roleFilter input[type="checkbox"]:checked')).map(cb => cb.value);
            const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
            const nameSearch = document.getElementById('userSearch').value.toLowerCase();
            const rows = document.querySelectorAll('tbody tr');

            rows.forEach(row => {
                const rowRole = row.getAttribute('data-role').toLowerCase();
                const rowStatus = row.getAttribute('data-status').toLowerCase();
                const rowName = row.getAttribute('data-name').toLowerCase();
                const rowEmail = row.getAttribute('data-email').toLowerCase();
                
                // Check role filter (if any roles selected, row must match one of them)
                const roleMatch = selectedRoles.length === 0 || selectedRoles.some(role => rowRole.includes(role));
                
                // Check status filter
                const statusMatch = !statusFilter || rowStatus === statusFilter;
                
                // Check name/email search (search in both name and email fields)
                const nameMatch = !nameSearch || rowName.includes(nameSearch) || rowEmail.includes(nameSearch);
                
                // Show/hide row based on all filters
                if (roleMatch && statusMatch && nameMatch) {
                    row.style.display = '';
                    row.classList.remove('hidden');
                } else {
                    row.style.display = 'none';
                    row.classList.add('hidden');
                }
            });
        }

        // Clear all filters and reset to default
        function clearAllFilters() {
            console.log('🔄 Clearing all filters...');
            
            // Clear role filter checkboxes
            const roleCheckboxes = document.querySelectorAll('#roleFilter input[type="checkbox"]');
            roleCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Update role filter button text
            const roleButtonText = document.getElementById('roleFilterText');
            if (roleButtonText) {
                roleButtonText.innerHTML = 'All Roles';
            }
            
            // Clear status filter
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.value = '';
            }
            
            // Clear name search
            const nameSearch = document.getElementById('userSearch');
            if (nameSearch) {
                nameSearch.value = '';
            }
            
            console.log('✅ All filters cleared');
            
            // Reapply filters (which will show all users)
            filterUsers();
            
            console.log('✅ Table reset to show all users');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.multi-select-dropdown')) {
                document.querySelectorAll('.multi-select-options.show').forEach(options => {
                    options.classList.remove('show');
                    options.closest('.multi-select-dropdown').querySelector('.multi-select-button').classList.remove('open');
                    options.closest('.multi-select-dropdown').querySelector('.multi-select-dropdown-arrow').classList.remove('open');
                });
            }
        });

        // Add event listeners for filters
        document.getElementById('statusFilter').addEventListener('change', filterUsers);
        document.getElementById('userSearch').addEventListener('input', filterUsers);

        // Initialize toggle switches
        attachToggleListeners();

        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        // Menu icon click handler
        document.querySelector('.menu-icon').addEventListener('click', function() {
            toggleSidebar();
        });

        // Sidebar navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Close sidebar after navigation on mobile
                toggleSidebar();
            });
        });

        // Tab navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all content sections
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show the appropriate content section
                const tabText = this.textContent.trim().toLowerCase();
                if (tabText === 'users') {
                    document.getElementById('usersSection').classList.add('active');
                } else if (tabText === 'customer') {
                    document.getElementById('customerSection').classList.add('active');
                } else if (tabText === 'roles') {
                    document.getElementById('rolesSection').classList.add('active');
                } else if (tabText === 'settings') {
                    document.getElementById('settingsSection').classList.add('active');
                }
                // Add more conditions for other tabs as needed
            });
        });

        // Input method toggle functionality
        function toggleInputMethod() {
            const manualInput = document.getElementById('manualInput');
            const bulkUpload = document.getElementById('bulkUpload');
            const manualSection = document.getElementById('manualInputSection');
            const bulkSection = document.getElementById('bulkUploadSection');
            const preferencesSection = document.getElementById('preferencesSection');
            
            if (manualInput.checked) {
                manualSection.style.display = 'block';
                bulkSection.classList.remove('active');
                // Keep preferences section if it was already loaded
            } else if (bulkUpload.checked) {
                manualSection.style.display = 'none';
                bulkSection.classList.add('active');
                // Hide preferences section when switching to bulk upload
                preferencesSection.classList.remove('active');
            }
        }

        // File handling functions
        function handleFileSelect(input) {
            const file = input.files[0];
            const fileInputText = document.getElementById('fileInputText');
            const fileInputDiv = document.querySelector('.file-input');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (file) {
                if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                    showUpdateMessage('Please select a CSV file.');
                    input.value = '';
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    showUpdateMessage('File size must be less than 10MB.');
                    input.value = '';
                    return;
                }
                
                fileInputText.textContent = file.name;
                fileInputDiv.classList.add('has-file');
                uploadBtn.disabled = false;
            } else {
                fileInputText.textContent = 'Click for selecting the .csv file to upload';
                fileInputDiv.classList.remove('has-file');
                uploadBtn.disabled = true;
            }
        }

        function uploadCSVFile() {
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showUpdateMessage('Please select a CSV file first.');
                return;
            }
            
            // Show progress bar
            const uploadProgress = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const uploadBtn = document.getElementById('uploadBtn');
            
            uploadProgress.style.display = 'block';
            uploadBtn.disabled = true;
            progressText.textContent = 'Uploading...';
            
            // Simulate file upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressFill.style.width = progress + '%';
                
                if (progress < 50) {
                    progressText.textContent = 'Uploading file...';
                } else if (progress < 80) {
                    progressText.textContent = 'Processing CSV data...';
                } else if (progress < 100) {
                    progressText.textContent = 'Updating customer preferences...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        progressText.textContent = 'Upload completed successfully!';
                        showUpdateMessage(`Successfully uploaded ${file.name} and updated customer preferences.`);
                        
                        // Reset form after successful upload
                        setTimeout(() => {
                            resetBulkUploadForm();
                        }, 2000);
                    }, 500);
                }
            }, 200);
        }

        function resetBulkUploadForm() {
            const fileInput = document.getElementById('csvFileInput');
            const fileInputText = document.getElementById('fileInputText');
            const fileInputDiv = document.querySelector('.file-input');
            const uploadBtn = document.getElementById('uploadBtn');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            
            fileInput.value = '';
            fileInputText.textContent = 'Click for selecting the .csv file to upload';
            fileInputDiv.classList.remove('has-file');
            uploadBtn.disabled = true;
            uploadProgress.style.display = 'none';
            progressFill.style.width = '0%';
        }

        function downloadSampleCSV() {
            // Create sample CSV content
            const csvContent = `Customer Account,App Push,SMS,Email
CL001,opt-in,opt-in,opt-out
CL002,opt-out,opt-in,opt-in
CL003,opt-in,opt-out,opt-in`;
            
            // Create and download the file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'customer_preferences_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showUpdateMessage('Sample CSV template downloaded successfully!');
        }

        // Bulk Upload Modal Functions
        function showBulkUploadModal() {
            const overlay = document.getElementById('bulkUploadOverlay');
            overlay.classList.add('show');
        }

        function hideBulkUploadModal() {
            const overlay = document.getElementById('bulkUploadOverlay');
            overlay.classList.remove('show');
        }

        function downloadBulkTemplate() {
            // Create template CSV content with proper column structure
            const csvContent = `Customer Account No.,App Push,SMS,Email
123456789,TRUE,FALSE,TRUE
987654321,FALSE,TRUE,FALSE
555666777,TRUE,TRUE,TRUE
111222333,FALSE,FALSE,TRUE`;
            
            // Create and download the file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bulk_upload_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showUpdateMessage('Bulk upload template downloaded successfully!');
        }

        // User Bulk Upload Functions
        function showBulkUploadUserModal() {
            document.getElementById('userBulkUploadOverlay').classList.add('show');
        }

        function hideUserBulkUploadModal() {
            document.getElementById('userBulkUploadOverlay').classList.remove('show');
        }

        function showImportSummaryModal(successCount, failedCount, errors) {
            // Update summary message
            const messageEl = document.getElementById('importSummaryMessage');
            if (failedCount === 0) {
                messageEl.textContent = 'Users are imported to system successfully.';
            } else if (successCount === 0) {
                messageEl.textContent = 'Import failed. No users were imported.';
            } else {
                messageEl.textContent = 'Import completed with some errors.';
            }

            // Update counts
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failedCount').textContent = failedCount;

            // Show/hide errors section
            const errorsSection = document.getElementById('importErrors');
            const errorsList = document.getElementById('importErrorsList');
            
            if (errors && errors.length > 0) {
                errorsSection.style.display = 'block';
                errorsList.innerHTML = errors.map(error => 
                    `<div class="import-error-item">${error}</div>`
                ).join('');
            } else {
                errorsSection.style.display = 'none';
            }

            // Show modal
            document.getElementById('importSummaryOverlay').classList.add('show');
        }

        function hideImportSummaryModal() {
            document.getElementById('importSummaryOverlay').classList.remove('show');
        }

        function showCustomerImportSummaryModal(successCount, failedCount, errors) {
            // Update summary message
            const messageEl = document.getElementById('customerImportSummaryMessage');
            if (failedCount === 0) {
                messageEl.textContent = 'Customer preferences are imported to system successfully.';
            } else if (successCount === 0) {
                messageEl.textContent = 'Customer import failed. No customer preferences were updated.';
            } else {
                messageEl.textContent = 'Customer import completed with some errors.';
            }

            // Update counts
            document.getElementById('customerSuccessCount').textContent = successCount;
            document.getElementById('customerFailedCount').textContent = failedCount;

            // Show/hide errors section
            const errorsSection = document.getElementById('customerImportErrors');
            const errorsList = document.getElementById('customerImportErrorsList');
            
            if (errors && errors.length > 0) {
                errorsSection.style.display = 'block';
                errorsList.innerHTML = errors.map(error => 
                    `<div class="import-error-item">${error}</div>`
                ).join('');
            } else {
                errorsSection.style.display = 'none';
            }

            // Show modal
            document.getElementById('customerImportSummaryOverlay').classList.add('show');
        }

        function hideCustomerImportSummaryModal() {
            document.getElementById('customerImportSummaryOverlay').classList.remove('show');
        }

        function downloadUserBulkTemplate() {
            // Create template CSV content for user bulk upload
            const csvContent = `Staff ID,Role
93313,System Admin
94567,CIC Team
95678,Account Manager
96789,Corporate Affairs
97890,Management
98901,PSBG Engineers`;
            
            // Create and download the file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'user_bulk_upload_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showUpdateMessage('User bulk upload template downloaded successfully!', 'success');
        }

        function selectUserBulkFile() {
            document.getElementById('userBulkFileInput').click();
        }

        function handleUserBulkFileSelect(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                showUpdateMessage('Please select a valid CSV file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csvData = e.target.result;
                processUserBulkUpload(csvData);
            };
            reader.readAsText(file);
        }

        function processUserBulkUpload(csvData) {
            const lines = csvData.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // Validate headers
            if (!headers.includes('Staff ID') || !headers.includes('Role')) {
                showUpdateMessage('CSV file must contain "Staff ID" and "Role" columns', 'error');
                return;
            }
            
            const staffIdIndex = headers.indexOf('Staff ID');
            const roleIndex = headers.indexOf('Role');
            
            let successCount = 0;
            let errorCount = 0;
            const errors = [];
            
            // Process each row (skip header)
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue; // Skip empty lines
                
                const values = line.split(',').map(v => v.trim());
                const staffId = values[staffIdIndex];
                const role = values[roleIndex];
                
                if (!staffId || !role) {
                    errorCount++;
                    errors.push(`Row ${i + 1}: Missing Staff ID or Role`);
                    continue;
                }
                
                // Demonstration: Add some validation examples
                if (i === 3) { // Row 3 example error
                    errorCount++;
                    errors.push(`Row ${i + 1}: Invalid Staff ID`);
                    continue;
                }
                
                // Check for duplicate users
                if (isDuplicateUser(`User${staffId}`)) { // Using a temp name for checking
                    errorCount++;
                    errors.push(`Row ${i + 1}: Staff ID ${staffId} already exists`);
                    continue;
                }
                
                // Create user (simplified - in real app would validate staff ID and get actual name/email)
                const newUser = {
                    staffId: staffId,
                    name: `User${staffId}`, // In real app, would lookup from HR system
                    email: `user${staffId}@clp.com`, // In real app, would lookup from HR system
                    role: role,
                    status: 'active',
                    lastLogin: 'Never'
                };
                
                addUserToTable(newUser);
                successCount++;
            }
            
            // Show results
            hideUserBulkUploadModal();
            
            // Show import summary modal
            showImportSummaryModal(successCount, errorCount, errors);
        }

        function selectBulkFile() {
            document.getElementById('bulkFileInput').click();
        }

        function handleBulkFileSelect(input) {
            const file = input.files[0];
            
            if (file) {
                if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                    showUpdateMessage('Please select a CSV file.');
                    input.value = '';
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    showUpdateMessage('File size must be less than 10MB.');
                    input.value = '';
                    return;
                }
                
                // Process the bulk upload
                processBulkUpload(file);
                
                // Close the modal
                hideBulkUploadModal();
            }
        }

        function processBulkUpload(file) {
            showUpdateMessage(`Processing bulk upload: ${file.name}`);
            
            // Simulate processing
            setTimeout(() => {
                // Simulate processing results with placeholder data
                const successCount = 8;
                const failedCount = 2;
                const errors = [
                    'Row 5: Invalid Customer Account Number format',
                    'Row 9: Missing Email preference setting'
                ];
                
                // Show customer import summary modal
                showCustomerImportSummaryModal(successCount, failedCount, errors);
                
                // Reset the file input
                document.getElementById('bulkFileInput').value = '';
            }, 2000);
        }

        // Close bulk upload modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('bulkUploadOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideBulkUploadModal();
                }
            });

            // Close user bulk upload modal when clicking outside
            document.getElementById('userBulkUploadOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideUserBulkUploadModal();
                }
            });

            // Close import summary modal when clicking outside
            document.getElementById('importSummaryOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideImportSummaryModal();
                }
            });

            // Close customer import summary modal when clicking outside
            document.getElementById('customerImportSummaryOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideCustomerImportSummaryModal();
                }
            });

            // Close role modal when clicking outside
            document.getElementById('roleModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideRoleModal();
                }
            });
        });

        // Role Management Functions
        let currentEditingRole = null;

        function showCreateRoleModal() {
            document.getElementById('roleModalTitle').textContent = 'Create New Role';
            document.getElementById('roleName').value = '';
            setAllPermissionsSelected();
            currentEditingRole = null;
            
            // Update button text for create mode
            const saveButton = document.querySelector('.role-modal-footer .btn-primary');
            saveButton.textContent = 'Create';
            
            document.getElementById('roleModalOverlay').classList.add('show');
        }

        function editRole(roleId) {
            document.getElementById('roleModalTitle').textContent = 'Edit Role';
            currentEditingRole = roleId;
            
            // Load role data based on roleId
            const roleData = getRoleData(roleId);
            document.getElementById('roleName').value = roleData.name;
            loadRolePermissions(roleData.permissions);
            
            // Update button text for edit mode
            const saveButton = document.querySelector('.role-modal-footer .btn-primary');
            saveButton.textContent = 'Update';
            
            document.getElementById('roleModalOverlay').classList.add('show');
        }

        function hideRoleModal() {
            document.getElementById('roleModalOverlay').classList.remove('show');
            currentEditingRole = null;
        }

        function togglePermission(element) {
            element.classList.toggle('selected');
            const icon = element.querySelector('.permission-icon-modal');
            const checkbox = element.querySelector('input[name="permissions"]');
            
            if (element.classList.contains('selected')) {
                icon.textContent = '✓';
                if (checkbox) checkbox.checked = true;
            } else {
                icon.textContent = '✗';
                if (checkbox) checkbox.checked = false;
            }
        }

        function clearRolePermissions() {
            const permissionItems = document.querySelectorAll('.permission-item-modal');
            permissionItems.forEach(item => {
                item.classList.remove('selected');
                const icon = item.querySelector('.permission-icon-modal');
                const checkbox = item.querySelector('input[name="permissions"]');
                icon.textContent = '✗';
                if (checkbox) checkbox.checked = false;
            });
        }

        function setAllPermissionsSelected() {
            const permissionItems = document.querySelectorAll('.permission-item-modal');
            permissionItems.forEach(item => {
                item.classList.add('selected');
                const icon = item.querySelector('.permission-icon-modal');
                const checkbox = item.querySelector('input[name="permissions"]');
                icon.textContent = '✓';
                if (checkbox) checkbox.checked = true;
            });
        }

        function loadRolePermissions(permissions) {
            clearRolePermissions();
            permissions.forEach(permission => {
                const permissionItem = document.querySelector(`[data-permission="${permission}"]`);
                if (permissionItem) {
                    permissionItem.classList.add('selected');
                    const icon = permissionItem.querySelector('.permission-icon-modal');
                    icon.textContent = '✓';
                }
            });
        }

        function getRoleData(roleId) {
            const roles = {
                'system-admin': {
                    name: 'System Admin',
                    permissions: ['dashboard', 'outage', 'emergency', 'user_admin', 'template', 'notifications', 'residential', 'non_residential', 'download', 'alerts']
                },
                'cic-team': {
                    name: 'CIC Team',
                    permissions: ['dashboard', 'outage', 'template', 'notifications', 'residential', 'download']
                },
                'account-manager': {
                    name: 'Account Manager',
                    permissions: ['dashboard', 'outage', 'non_residential', 'download']
                },
                'corporate-affairs': {
                    name: 'Corporate Affairs',
                    permissions: ['dashboard', 'outage']
                },
                'management': {
                    name: 'Management',
                    permissions: ['dashboard', 'outage', 'emergency']
                },
                'psbg-engineers': {
                    name: 'PSBG Engineers',
                    permissions: ['dashboard', 'outage']
                }
            };
            return roles[roleId] || { name: '', permissions: [] };
        }

        function isDuplicateRoleName(roleName, currentEditingRoleId = null) {
            const existingRoles = {
                'system-admin': 'System Admin',
                'cic-team': 'CIC Team',
                'account-manager': 'Account Manager',
                'corporate-affairs': 'Corporate Affairs',
                'management': 'Management',
                'psbg-engineers': 'PSBG Engineers'
            };
            
            // Get current role name if editing
            const currentRoleName = currentEditingRoleId ? existingRoles[currentEditingRoleId] : null;
            
            // Case-insensitive comparison, excluding current role being edited
            return Object.values(existingRoles).some(existingName => 
                existingName.toLowerCase() === roleName.toLowerCase() && 
                existingName !== currentRoleName
            );
        }

        function saveRole() {
            const roleName = document.getElementById('roleName').value.trim();
            if (!roleName) {
                showUpdateMessage('Please enter a role name!', 'error');
                return;
            }

            // Check for duplicate role names
            if (isDuplicateRoleName(roleName, currentEditingRole)) {
                showUpdateMessage(`Role name "${roleName}" already exists! Please choose a different name.`, 'error');
                return;
            }

            const selectedPermissions = [];
            const selectedItems = document.querySelectorAll('.permission-item-modal.selected');
            selectedItems.forEach(item => {
                selectedPermissions.push(item.dataset.permission);
            });

            if (currentEditingRole) {
                // Update existing role on screen
                updateRoleCardOnScreen(currentEditingRole, roleName, selectedPermissions);
                showUpdateMessage(`Role "${roleName}" updated successfully!`, 'success');
            } else {
                // Create new role
                showUpdateMessage(`Role "${roleName}" created successfully!`, 'success');
            }

            hideRoleModal();
        }

        function updateRoleCardOnScreen(roleId, roleName, selectedPermissions) {
            // Find the role card by roleId
            const roleCard = document.querySelector(`[onclick*="${roleId}"]`).closest('.role-card');
            
            if (roleCard) {
                // Update role name
                const roleNameElement = roleCard.querySelector('.role-name');
                roleNameElement.textContent = roleName;
                
                // Update permissions display
                const permissionsContainer = roleCard.querySelector('.role-permissions');
                
                // Define all possible permissions
                const allPermissions = [
                    { key: 'dashboard', label: 'Full Dashboard Access' },
                    { key: 'outage', label: 'Outage Management' },
                    { key: 'emergency', label: 'Emergency Stop' },
                    { key: 'user_admin', label: 'User Administration' },
                    { key: 'template', label: 'Template Management' },
                    { key: 'notifications', label: 'Send Notifications' },
                    { key: 'residential', label: 'Access Residential Customer Information' },
                    { key: 'non_residential', label: 'Access Non-Residential Customer Information' },
                    { key: 'download', label: 'Download Data' },
                    { key: 'alerts', label: 'Receive Alert Message' }
                ];
                
                // Clear existing permissions
                permissionsContainer.innerHTML = '';
                
                // Add updated permissions
                allPermissions.forEach(permission => {
                    const isGranted = selectedPermissions.includes(permission.key);
                    const permissionDiv = document.createElement('div');
                    permissionDiv.className = `permission-item ${isGranted ? 'granted' : 'denied'}`;
                    
                    permissionDiv.innerHTML = `
                        <span class="permission-icon">${isGranted ? '✓' : '✗'}</span>
                        <span>${permission.label}</span>
                    `;
                    
                    permissionsContainer.appendChild(permissionDiv);
                });
            }
        }

        // Global variable to store the role being deleted
        let roleToDelete = null;

        function deleteRole(roleId) {
            const roleData = getRoleData(roleId);
            roleToDelete = { id: roleId, data: roleData };
            
            // Check if this is System Admin role and has users assigned
            if (roleData.name === 'System Admin') {
                // Show warning for System Admin role with assigned users
                showRoleAssignmentWarning('Arthur Chan'); // Example user
                return;
            }
            
            // Show confirmation modal for other roles
            showRoleDeleteConfirmation(roleData.name);
        }

        function showRoleDeleteConfirmation(roleName) {
            const modal = document.getElementById('roleDeleteModal');
            const message = document.getElementById('roleDeleteMessage');
            message.textContent = `Are you sure you want to delete the role "${roleName}"? This action cannot be undone.`;
            modal.classList.add('show');
        }

        function hideRoleDeleteModal() {
            const modal = document.getElementById('roleDeleteModal');
            modal.classList.remove('show');
            roleToDelete = null;
        }

        function confirmRoleDeletion() {
            if (roleToDelete) {
                // Remove the role card from the DOM
                removeRoleCardFromScreen(roleToDelete.id);
                
                // Show success message
                showUpdateMessage(`Role "${roleToDelete.data.name}" deleted successfully!`, 'success');
                
                // Hide the modal
                hideRoleDeleteModal();
            }
        }

        function removeRoleCardFromScreen(roleId) {
            // Find the role card by looking for the edit button with the roleId
            const editButton = document.querySelector(`[onclick*="editRole('${roleId}')"]`);
            if (editButton) {
                const roleCard = editButton.closest('.role-card');
                if (roleCard) {
                    // Add fade-out animation
                    roleCard.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                    roleCard.style.opacity = '0';
                    roleCard.style.transform = 'scale(0.95)';
                    
                    // Remove the card after animation
                    setTimeout(() => {
                        roleCard.remove();
                    }, 300);
                }
            }
        }

        function showRoleAssignmentWarning(userName) {
            const modal = document.getElementById('roleAssignmentWarningModal');
            const message = document.getElementById('roleAssignmentWarningMessage');
            message.textContent = `Please assign a role for User: ${userName} before deleting this role`;
            modal.classList.add('show');
        }

        function hideRoleAssignmentWarningModal() {
            const modal = document.getElementById('roleAssignmentWarningModal');
            modal.classList.remove('show');
            roleToDelete = null;
        }

        // Close modals when clicking outside
        document.getElementById('roleDeleteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideRoleDeleteModal();
            }
        });

        document.getElementById('roleAssignmentWarningModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideRoleAssignmentWarningModal();
            }
        });

        // Customer Management Functions
        function loadCustomerPreference() {
            const customerAccount = document.getElementById('customerAccount').value;
            if (!customerAccount.trim()) {
                showUpdateMessage('Please enter a Customer Account number!');
                return;
            }
            
            // Show loading message
            showUpdateMessage(`Loading preferences for Customer Account: ${customerAccount}`);
            
            // Simulate loading customer preferences
            setTimeout(() => {
                // Show the preferences section
                const preferencesSection = document.getElementById('preferencesSection');
                preferencesSection.classList.add('active');
                
                // Load sample preference data
                loadSamplePreferences();
                
                showUpdateMessage(`Customer preferences loaded successfully for ${customerAccount}!`);
            }, 1000);
        }

        function loadSamplePreferences() {
            // Set sample preferences (matching the screenshot)
            // App Push: Opt-in (toggle active/blue)
            document.querySelector('[data-channel="app-push"]').classList.add('active');
            
            // SMS: Opt-in (toggle active/blue)
            document.querySelector('[data-channel="sms"]').classList.add('active');
            
            // Email: Opt-out (toggle inactive/gray)
            document.querySelector('[data-channel="email"]').classList.remove('active');
            
            // Update main toggle state based on individual channel states
            updateMainToggleState();
        }

        function toggleMainPreference() {
            const mainToggle = document.getElementById('mainToggle');
            mainToggle.classList.toggle('active');
            
            const isActive = mainToggle.classList.contains('active');
            
            // Sync all channel toggles to match the main toggle state
            const channelToggles = document.querySelectorAll('.channel-toggle');
            channelToggles.forEach(toggle => {
                if (isActive) {
                    // Main toggle is ON (blue) - set all channels to opt-in (blue)
                    toggle.classList.add('active');
                } else {
                    // Main toggle is OFF (gray) - set all channels to opt-out (gray)
                    toggle.classList.remove('active');
                }
            });
            
            const status = isActive ? 'opt-in' : 'opt-out';
            showUpdateMessage(`All channels set to ${status} globally.`);
        }

        function toggleChannel(toggleElement) {
            const channel = toggleElement.getAttribute('data-channel');
            
            // Toggle the channel state
            toggleElement.classList.toggle('active');
            
            const isOptIn = toggleElement.classList.contains('active');
            const status = isOptIn ? 'opt-in' : 'opt-out';
            
            // Update main toggle based on individual channel states
            updateMainToggleState();
            
            showUpdateMessage(`${channel.toUpperCase().replace('-', ' ')} channel set to ${status}.`);
        }

        function updateMainToggleState() {
            const mainToggle = document.getElementById('mainToggle');
            const channelToggles = document.querySelectorAll('.channel-toggle');
            
            // Check if all channel toggles are active (opt-in)
            const allOptIn = Array.from(channelToggles).every(toggle => toggle.classList.contains('active'));
            
            // Check if all channel toggles are inactive (opt-out)
            const allOptOut = Array.from(channelToggles).every(toggle => !toggle.classList.contains('active'));
            
            if (allOptIn) {
                // All channels are opt-in, set main toggle to active
                mainToggle.classList.add('active');
            } else if (allOptOut) {
                // All channels are opt-out, set main toggle to inactive
                mainToggle.classList.remove('active');
            }
            // If channels are mixed (some opt-in, some opt-out), leave main toggle as-is
        }

        function generateOptOutReport() {
            const customerAccount = document.getElementById('customerAccount').value;
            
            // Show the report overlay
            showOptOutReport();
            
            // Show message with or without customer account
            if (customerAccount.trim()) {
                showUpdateMessage(`Generating Opt-Out Exception Report for Customer Account: ${customerAccount}`);
            } else {
                showUpdateMessage('Generating Opt-Out Exception Report for all customers');
            }
        }

        function showOptOutReport() {
            const reportOverlay = document.getElementById('reportOverlay');
            reportOverlay.classList.add('show');
            
            // Reset filters to default
            document.getElementById('dateFilter').value = 'today';
            document.getElementById('customerSearch').value = '';
            
            // Apply initial filter
            filterReportData();
        }

        function hideOptOutReport() {
            const reportOverlay = document.getElementById('reportOverlay');
            reportOverlay.classList.remove('show');
        }

        function filterReportData() {
            const dateFilter = document.getElementById('dateFilter').value;
            const customerSearch = document.getElementById('customerSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#reportTableBody tr');
            const today = new Date();
            
            rows.forEach(row => {
                const rowDate = new Date(row.getAttribute('data-date'));
                const customerAccount = row.getAttribute('data-account').toLowerCase();
                
                let showRow = true;
                
                // Apply date filter
                if (dateFilter === 'today') {
                    const isToday = rowDate.toDateString() === today.toDateString();
                    if (!isToday) showRow = false;
                } else if (dateFilter === '7days') {
                    const sevenDaysAgo = new Date(today);
                    sevenDaysAgo.setDate(today.getDate() - 7);
                    if (rowDate < sevenDaysAgo) showRow = false;
                } else if (dateFilter === '30days') {
                    const thirtyDaysAgo = new Date(today);
                    thirtyDaysAgo.setDate(today.getDate() - 30);
                    if (rowDate < thirtyDaysAgo) showRow = false;
                }
                
                // Apply customer search filter
                if (customerSearch && !customerAccount.includes(customerSearch)) {
                    showRow = false;
                }
                
                // Show or hide row
                if (showRow) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Check if any rows are visible
            const visibleRows = Array.from(rows).filter(row => row.style.display !== 'none');
            if (visibleRows.length === 0) {
                showNoDataMessage();
            } else {
                hideNoDataMessage();
            }
        }

        function showNoDataMessage() {
            const tbody = document.getElementById('reportTableBody');
            let noDataRow = tbody.querySelector('.no-data-row');
            
            if (!noDataRow) {
                noDataRow = document.createElement('tr');
                noDataRow.className = 'no-data-row';
                noDataRow.innerHTML = '<td colspan="3" class="no-data">No data found for the selected criteria</td>';
                tbody.appendChild(noDataRow);
            }
            
            noDataRow.style.display = '';
        }

        function hideNoDataMessage() {
            const tbody = document.getElementById('reportTableBody');
            const noDataRow = tbody.querySelector('.no-data-row');
            if (noDataRow) {
                noDataRow.style.display = 'none';
            }
        }

        // Close report overlay when clicking outside
        document.getElementById('reportOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                hideOptOutReport();
            }
        });

        // Keyboard support for sidebar
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                
                if (sidebar.classList.contains('show')) {
                    sidebar.classList.remove('show');
                    overlay.classList.remove('show');
                }
            }
        });

        function saveCustomerForm() {
            const customerAccount = document.getElementById('customerAccount').value;
            const inputMethod = document.querySelector('input[name="inputMethod"]:checked').value;
            
            if (!customerAccount.trim()) {
                showUpdateMessage('Please enter a Customer Account number!');
                return;
            }
            
            // Check if preferences are loaded
            const preferencesSection = document.getElementById('preferencesSection');
            const preferencesLoaded = preferencesSection.classList.contains('active');
            
            let message = `Saving customer preferences for ${customerAccount} using ${inputMethod} input method`;
            
            if (preferencesLoaded) {
                // Collect preferences data
                const preferences = collectPreferencesData();
                message += ` with channel preferences`;
            }
            
            showUpdateMessage(message + '...');
            
            // Here you would typically make an API call to save the data
            setTimeout(() => {
                showUpdateMessage(`Customer preferences saved successfully for ${customerAccount}!`);
            }, 1000);
        }

        function collectPreferencesData() {
            const preferences = {
                mainToggle: document.getElementById('mainToggle').classList.contains('active'),
                channels: {}
            };
            
            // Collect channel preferences
            ['app-push', 'sms', 'email'].forEach(channel => {
                const toggle = document.querySelector(`[data-channel="${channel}"]`);
                const isOptIn = toggle.classList.contains('active');
                
                preferences.channels[channel] = {
                    status: isOptIn ? 'opt-in' : 'opt-out'
                };
            });
            
            return preferences;
        }

        function cancelCustomerForm() {
            // Reset form to default values
            document.getElementById('customerAccount').value = 'CL003';
            document.getElementById('manualInput').checked = true;
            
            // Reset input method sections
            toggleInputMethod();
            
            // Reset bulk upload form
            resetBulkUploadForm();
            
            // Hide preferences section
            const preferencesSection = document.getElementById('preferencesSection');
            preferencesSection.classList.remove('active');
            
            showUpdateMessage('Customer form has been reset to default values.');
        }

        // Pagination
        document.querySelectorAll('.pagination button').forEach(btn => {
            btn.addEventListener('click', function() {
                if (!this.textContent.includes('‹') && !this.textContent.includes('›') && !this.textContent.includes('...')) {
                    document.querySelectorAll('.pagination button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Settings Functions
        function toggleSettingsGroup(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.settings-group-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.textContent = '▶';
                icon.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                icon.textContent = '▼';
                icon.classList.add('expanded');
            }
        }

        function toggleSetting(toggleElement) {
            toggleElement.classList.toggle('active');
            const label = toggleElement.querySelector('.toggle-label');
            
            if (toggleElement.classList.contains('active')) {
                label.textContent = 'ON';
            } else {
                label.textContent = 'OFF';
            }
        }

        // Global variable to store toggle context
        let pendingToggle = null;

        function toggleCommunicationSetting(toggleElement, type) {
            // If turning OFF internal communication, show acknowledgment modal
            if (type === 'internal' && toggleElement.classList.contains('active')) {
                pendingToggle = { element: toggleElement, type: type };
                showCommunicationToggleModal();
            } else {
                // For turning ON or external communication, toggle directly
                toggleSetting(toggleElement);
            }
        }

        function showCommunicationToggleModal() {
            const modal = document.getElementById('communicationToggleModal');
            modal.classList.add('show');
        }

        function hideCommunicationToggleModal() {
            const modal = document.getElementById('communicationToggleModal');
            modal.classList.remove('show');
            pendingToggle = null;
        }

        function confirmCommunicationToggle() {
            if (pendingToggle) {
                // Proceed with the toggle
                toggleSetting(pendingToggle.element);
                showUpdateMessage('Please click [Save] to update the Internal Communication setting', 'success');
            }
            hideCommunicationToggleModal();
        }

        function cancelCommunicationToggle() {
            // Do nothing, just close the modal
            hideCommunicationToggleModal();
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('communicationToggleModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    cancelCommunicationToggle();
                }
            });
        });

        // Integer input validation function
        function validateIntegerInput(input) {
            // Remove any non-digit characters (letters, symbols, etc.)
            let value = input.value;
            
            // Remove any non-numeric characters except minus at the start
            value = value.replace(/[^\d-]/g, '');
            
            // Remove minus signs that aren't at the start
            if (value.indexOf('-') > 0) {
                value = value.replace(/-/g, '');
            }
            
            // Remove leading minus (we don't want negative numbers)
            value = value.replace(/^-/, '');
            
            // Update the input value
            input.value = value;
            
            // Visual feedback for empty value
            if (value === '' || value === '0') {
                input.style.borderColor = '#ff6b6b';
                input.style.backgroundColor = '#fff5f5';
            } else {
                input.style.borderColor = '';
                input.style.backgroundColor = '';
            }
        }

        // Validate all integer inputs in a section
        function validateIntegerInputs(sectionSelector) {
            const inputs = document.querySelectorAll(`${sectionSelector} .integer-only`);
            let isValid = true;
            let errorMessages = [];
            
            inputs.forEach(input => {
                const label = input.previousElementSibling?.textContent || input.closest('.setting-item')?.querySelector('.setting-label')?.textContent || 'Field';
                
                if (!input.value || input.value.trim() === '' || input.value === '0') {
                    isValid = false;
                    input.style.borderColor = '#ff6b6b';
                    input.style.backgroundColor = '#fff5f5';
                    errorMessages.push(`${label} cannot be empty or zero`);
                } else if (!/^\d+$/.test(input.value)) {
                    isValid = false;
                    input.style.borderColor = '#ff6b6b';
                    input.style.backgroundColor = '#fff5f5';
                    errorMessages.push(`${label} must be a valid integer`);
                } else {
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                }
            });
            
            if (!isValid) {
                showUpdateMessage(errorMessages[0], 'error');
            }
            
            return isValid;
        }

        function saveSystemSettings() {
            // Get all three setting inputs from System Settings section
            const systemSettingsInputs = document.querySelectorAll('#settingsSection .settings-group:first-of-type .setting-input.integer-only');
            
            if (systemSettingsInputs.length !== 3) {
                console.error('Expected 3 system setting inputs, found:', systemSettingsInputs.length);
                showUpdateMessage('Error: System setting cannot be empty', 'error');
                return;
            }
            
            // Validate each input
            let hasError = false;
            let errorMessage = '';
            
            systemSettingsInputs.forEach((input, index) => {
                const label = input.closest('.setting-item').querySelector('.setting-label').textContent;
                const value = input.value.trim();
                
                if (!value || value === '' || value === '0') {
                    hasError = true;
                    if (!errorMessage) {
                        errorMessage = `Please enter a valid value for "${label}"`;
                    }
                    input.style.borderColor = '#ff6b6b';
                    input.style.backgroundColor = '#fff5f5';
                } else if (!/^\d+$/.test(value)) {
                    hasError = true;
                    if (!errorMessage) {
                        errorMessage = `"${label}" must be a valid integer`;
                    }
                    input.style.borderColor = '#ff6b6b';
                    input.style.backgroundColor = '#fff5f5';
                } else {
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                }
            });
            
            // Show warning and stop if validation fails
            if (hasError) {
                showUpdateMessage(errorMessage, 'error');
                return;
            }
            
            // Get validated values
            const dataRetention = systemSettingsInputs[0].value;
            const updateInterval = systemSettingsInputs[1].value;
            const maxTimes = systemSettingsInputs[2].value;
            
            // Get toggle states
            const toggles = document.querySelectorAll('#settingsSection .settings-group:first-of-type .toggle-switch');
            const internalComm = toggles[0].classList.contains('active');
            const externalComm = toggles[1].classList.contains('active');
            
            // Show success message
            showUpdateMessage('System settings saved successfully!', 'success');
            
            // In a real application, you would send this data to the server
            console.log('Settings saved:', {
                dataRetention,
                updateInterval,
                maxTimes,
                internalComm,
                externalComm
            });
        }

        function cancelSystemSettings() {
            // Reset form to original values
            const inputs = document.querySelectorAll('.setting-input');
            inputs[0].value = '16';
            inputs[1].value = '30';
            inputs[2].value = '10';
            
            // Reset toggles to active state
            const toggles = document.querySelectorAll('.toggle-switch');
            toggles.forEach(toggle => {
                toggle.classList.add('active');
                toggle.querySelector('.toggle-label').textContent = 'ON';
            });
            
            showUpdateMessage('Settings reset to original values', 'success');
        }

        // Trigger Mode Functions
        function toggleTriggerSetting(toggleElement, triggerType) {
            // Toggle the clicked switch independently
            // No mutual exclusivity - each trigger can be toggled on/off independently
            toggleSetting(toggleElement);
        }

        function saveTriggerModeSettings() {
            // Get trigger mode states
            const triggerSwitches = document.querySelectorAll('.trigger-item .toggle-switch');
            const autoTrigger = triggerSwitches[0].classList.contains('active');
            const manualTrigger = triggerSwitches[1].classList.contains('active');
            const extremeWeather = triggerSwitches[2].classList.contains('active');
            
            // Show success message
            showUpdateMessage('Trigger mode settings saved successfully!', 'success');
            
            // In a real application, you would send this data to the server
            console.log('Trigger Mode settings saved:', {
                autoTrigger,
                manualTrigger,
                extremeWeather
            });
        }

        function cancelTriggerModeSettings() {
            // Reset to default state (Auto ON, others OFF)
            const triggerSwitches = document.querySelectorAll('.trigger-item .toggle-switch');
            
            // Auto Trigger ON
            triggerSwitches[0].classList.add('active');
            triggerSwitches[0].querySelector('.toggle-label').textContent = 'ON';
            
            // Manual Trigger OFF
            triggerSwitches[1].classList.remove('active');
            triggerSwitches[1].querySelector('.toggle-label').textContent = 'OFF';
            
            // Extreme Weather OFF
            triggerSwitches[2].classList.remove('active');
            triggerSwitches[2].querySelector('.toggle-label').textContent = 'OFF';
            
            showUpdateMessage('Trigger mode settings reset to default values', 'success');
        }

        // Extreme Weather Mode Functions
        let pendingExtremeWeatherToggle = null;

        function toggleExtremeWeatherSetting(toggleElement) {
            console.log('🌦️ toggleExtremeWeatherSetting called');
            // Show acknowledgment modal for both turning ON and OFF
            pendingExtremeWeatherToggle = { element: toggleElement };
            showExtremeWeatherModal();
        }

        function showExtremeWeatherModal() {
            console.log('🌦️ showExtremeWeatherModal called');
            const modal = document.getElementById('extremeWeatherModal');
            modal.classList.add('show');
            console.log('🌦️ Modal classes:', modal.className);
        }

        function hideExtremeWeatherModal() {
            console.log('🌦️ hideExtremeWeatherModal called');
            const modal = document.getElementById('extremeWeatherModal');
            modal.classList.remove('show');
            console.log('🌦️ Modal classes after hide:', modal.className);
            pendingExtremeWeatherToggle = null;
        }

        function confirmExtremeWeatherToggle() {
            console.log('🌦️ confirmExtremeWeatherToggle called');
            if (pendingExtremeWeatherToggle) {
                // Proceed with the toggle
                toggleSetting(pendingExtremeWeatherToggle.element);
                console.log('🌦️ About to show update message');
                showUpdateMessage('Please click [Save] to update the Extreme Weather Mode setting', 'success');
            }
            hideExtremeWeatherModal();
        }

        function cancelExtremeWeatherToggle() {
            console.log('🌦️ cancelExtremeWeatherToggle called');
            // Do NOT toggle - keep the current state
            // Just close the modal without any changes
            hideExtremeWeatherModal();
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('extremeWeatherModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    cancelExtremeWeatherToggle();
                }
            });
        });

        // Delay & Control Functions
        function saveDelayControlSettings() {
            // Validate inputs first
            if (!validateIntegerInputs('.delay-settings')) {
                return;
            }
            
            // Get delay setting values
            const delayInputs = document.querySelectorAll('.delay-settings .setting-input');
            const normalWeatherDelay = delayInputs[0].value;
            const extremeWeatherDelay = delayInputs[1].value;
            
            // Show success message
            showUpdateMessage('Delay & Control settings saved successfully!', 'success');
            
            // In a real application, you would send this data to the server
            console.log('Delay & Control settings saved:', {
                normalWeatherDelay,
                extremeWeatherDelay
            });
        }

        function cancelDelayControlSettings() {
            // Reset form to original values
            const delayInputs = document.querySelectorAll('.delay-settings .setting-input');
            delayInputs[0].value = '30';
            delayInputs[1].value = '30';
            
            showUpdateMessage('Delay & Control settings reset to original values', 'success');
        }

        // Alert Message Triggering Functions
        function saveAlertTriggeringSettings() {
            // Validate inputs first
            if (!validateIntegerInputs('.alert-settings')) {
                return;
            }
            
            // Get alert triggering setting value
            const alertInput = document.querySelector('.alert-settings .inline-input');
            const alertTriggerTime = alertInput.value;
            
            // Show success message
            showUpdateMessage('Alert Message Triggering settings saved successfully!', 'success');
            
            // In a real application, you would send this data to the server
            console.log('Alert Message Triggering settings saved:', {
                alertTriggerTime
            });
        }

        function cancelAlertTriggeringSettings() {
            // Reset form to original value
            const alertInput = document.querySelector('.alert-settings .inline-input');
            alertInput.value = '20';
            
            showUpdateMessage('Alert Message Triggering settings reset to original value', 'success');
        }

        // Initialize toggle switch tooltips
        function initializeToggleTooltips() {
            // User table toggle switches
            const userTableToggleSwitches = document.querySelectorAll('.user-table .toggle-switch');
            userTableToggleSwitches.forEach(toggle => {
                toggle.setAttribute('title', 'Active/Inactive');
            });
            
            // Communication setting toggles
            const commToggleSwitches = document.querySelectorAll('.toggle-group .toggle-switch');
            commToggleSwitches.forEach(toggle => {
                toggle.setAttribute('title', 'On/Off');
            });
            
            // Trigger mode toggles
            const triggerToggleSwitches = document.querySelectorAll('.trigger-item .toggle-switch');
            triggerToggleSwitches.forEach(toggle => {
                toggle.setAttribute('title', 'On/Off');
            });
        }



        // Initialize tooltips when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeToggleTooltips();
            
            // Add click handlers to user table toggle switches (initial load)
            attachToggleListeners();
        });
    </script>
</body>
</html>